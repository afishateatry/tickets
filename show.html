<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–û —Å–æ–±—ã—Ç–∏–∏</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f3f4f6;--card:#fff;--text:#0b0b0c;--muted:#6b7280;--line:#e5e7eb;--shadow:0 18px 40px rgba(0,0,0,.12);}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:900px;margin:0 auto;padding:12px 12px 40px;}
    .top{display:flex;gap:10px;justify-content:space-between;align-items:center;margin:10px 0 12px;}
    a.pill{display:inline-flex;gap:8px;align-items:center;padding:10px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;color:var(--text);text-decoration:none;font-weight:800;font-size:14px}
    .card{background:#fff;border:1px solid var(--line);border-radius:20px;box-shadow:var(--shadow);overflow:hidden;}
    .head{display:grid;grid-template-columns:140px 1fr;gap:16px;padding:16px;border-bottom:1px solid var(--line);}
    .poster{width:140px;height:140px;border-radius:14px;overflow:hidden;background:#111;box-shadow:0 10px 18px rgba(0,0,0,.15)}
    .poster img{width:100%;height:100%;object-fit:cover;display:block}
    .h1{font-size:40px;font-weight:900;line-height:1.05;margin:4px 0 8px}
    .sub{font-size:16px;font-weight:800}
    .sub span{display:block;font-weight:700;color:var(--muted);margin-top:4px}
    .buy{display:inline-flex;align-items:center;justify-content:center;width:min(520px,100%);height:66px;background:linear-gradient(180deg,#1a1a1b,#000);color:#fff;border:none;border-radius:12px;font-weight:900;font-size:20px;cursor:pointer;text-decoration:none;box-shadow:0 16px 30px rgba(0,0,0,.18)}
    .content{padding:18px;}
    h2{margin:0 0 14px;font-size:40px;font-weight:900}
    .kv{font-size:18px;line-height:1.55;margin-bottom:18px}
    .kv b{font-weight:900}
    .kv div{margin:6px 0}
    .desc{font-size:18px;line-height:1.7;color:#374151;white-space:pre-wrap}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <a class="pill" href="index.html?v=2">‚Üê –ê—Ñ–∏—à–∞</a>
    <a class="pill" href="wallet.html?v=2">üí≥ –ö–æ—à–µ–ª—ë–∫</a>
  </div>

  <div class="card">
    <div class="head">
      <div class="poster"><img id="poster" alt=""></div>
      <div>
        <div class="h1" id="title"></div>
        <div class="sub" id="meta"><span id="venue"></span></div>
        <a class="buy" id="goBuy" href="#">–ö—É–ø–∏—Ç—å</a>
        <div style="color:#6b7280;font-weight:800;font-size:14px;margin-top:10px">
          –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ö–µ–º—É –∑–∞–ª–∞ ‚Üí –≤—ã–±–æ—Ä –º–µ—Å—Ç ‚Üí –æ–ø–ª–∞—Ç–∞ —Å –∫–æ—à–µ–ª—å–∫–∞
        </div>
      </div>
    </div>

    <div class="content">
      <h2>–û —Å–æ–±—ã—Ç–∏–∏:</h2>
      <div class="kv" id="about"></div>

      <h2>–ê–∫—Ç—ë—Ä—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤:</h2>
      <div class="kv" id="cast"></div>

      <h2>–û–ø–∏—Å–∞–Ω–∏–µ:</h2>
      <div class="desc" id="desc"></div>
    </div>
  </div>
</div>

<script>
const K = { EVENTS:"THEATRE_EVENTS_V2", HIDDEN:"THEATRE_HIDDEN_EVENTS_V2" };
function qs(k){ return new URLSearchParams(location.search).get(k); }
function loadEvents(){ return JSON.parse(localStorage.getItem(K.EVENTS)||'{"events":[]}'); }
function hiddenSet(){ return new Set(JSON.parse(localStorage.getItem(K.HIDDEN)||"[]")); }
function formatRU(isoDate){ const [y,m,d]=String(isoDate||"").split("-"); return y?`${d}.${m}.${y}`:""; }

const id = qs("id");
const {events} = loadEvents();
const e = events.find(x=>x.id===id);

if(!id || !e || hiddenSet().has(id)){
  document.body.innerHTML = "<div style='padding:18px;font-family:Inter;font-weight:900'>–°–æ–±—ã—Ç–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –û—Ç–∫—Ä–æ–π –ê—Ñ–∏—à—É –∑–∞–Ω–æ–≤–æ.</div>";
  throw new Error("not found");
}

// –í–ê–ñ–ù–û: buy –≤—Å–µ–≥–¥–∞ —Å id + –∞–Ω—Ç–∏-–∫—ç—à
document.getElementById("goBuy").href = `buy.html?id=${encodeURIComponent(e.id)}&v=2`;

document.getElementById("poster").src = e.poster || "";
document.getElementById("title").textContent = e.title || "–°–ø–µ–∫—Ç–∞–∫–ª—å";
document.getElementById("meta").firstChild.textContent = `${e.city||"–ú–æ—Å–∫–≤–∞"}, ${formatRU(e.date)}, ${e.time||"21:00"}`;
document.getElementById("venue").textContent = e.venue || "–ú–æ—Å–∫–≤–∞, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è 6";

// –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –¥–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ ‚Äî –ø–æ–¥—Å—Ç–∞–≤–∏–º –¥–µ—Ñ–æ–ª—Ç—ã
const about = e.about || {
  director:"–ï–≤–≥–µ–Ω–∏–π –ü–∏—Å–∞—Ä–µ–≤", artist:"–ê–Ω–¥—Ä–µ–∞—Å —Ñ–æ–Ω –®–ª–∏–ø–ø–µ", producer:"–í–ª–∞–¥–∏–º–∏—Ä –ü—Ä—É–¥–∫–∏–Ω",
  music:"–¢–∏–º—É—Ä –ü–æ–ª—è–Ω—Å–∫–∏–π", light:"–°–µ—Ä–≥–µ–π –ù–µ–≤–≥–∞–¥–æ–≤—Å–∫–∏–π", ballet:"–ê–Ω–∂–µ–ª–∏–∫–∞ –ë–æ—Ä–∏—Å–æ–≤–∞",
  sound:"–°–µ—Ä–≥–µ–π –®–µ–≤—á–µ–Ω–∫–æ", video:"–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë—Ä–∞—Ç–∏–Ω–æ–≤", assistant:"–õ—é–±–æ–≤—å –°–∫–∏—Ä–∫–æ"
};

const labels = {
  director:"–†–µ–∂–∏—Å—Å–µ—Ä-–ø–æ—Å—Ç–∞–Ω–æ–≤—â–∏–∫", artist:"–•—É–¥–æ–∂–Ω–∏–∫-–ø–æ—Å—Ç–∞–Ω–æ–≤—â–∏–∫", producer:"–ü—Ä–æ–¥—é—Å–µ—Ä—ã",
  costume:"–•—É–¥–æ–∂–Ω–∏–∫ –ø–æ –∫–æ—Å—Ç—é–º–∞–º", music:"–ú—É–∑—ã–∫–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ", light:"–•—É–¥–æ–∂–Ω–∏–∫ –ø–æ –æ—Å–≤–µ—â–µ–Ω–∏—é",
  ballet:"–ë–∞–ª–µ—Ç–º–µ–π—Å—Ç–µ—Ä", sound:"–ó–≤—É–∫–æ—Ä–µ–∂–∏—Å—Å–µ—Ä", video:"–í–∏–¥–µ–æ", assistant:"–ü–æ–º–æ—â–Ω–∏–∫ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞",
};

document.getElementById("about").innerHTML =
  Object.entries(about).map(([k,v])=>`<div><b>${labels[k]||k}</b> ‚Äî ${v}</div>`).join("");

document.getElementById("cast").innerHTML =
  (e.cast||[]).length ? (e.cast||[]).map(x=>`<div><b>${x.actor}</b> - ${x.role}</div>`).join("")
  : "<div style='color:#6b7280;font-weight:700'>–°–æ—Å—Ç–∞–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è</div>";

document.getElementById("desc").textContent =
  (e.description && e.description.trim().length>20) ? e.description : "–û–ø–∏—Å–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.";
</script>
</body>
</html>
