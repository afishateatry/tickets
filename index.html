<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ê–§–ò–®–ê ‚Äî –¢–µ–∞—Ç—Ä</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f3f4f6; --card:#fff; --text:#0b0b0c; --muted:#6b7280;
      --line:#e5e7eb; --shadow:0 18px 40px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(#0b0b0c 0 280px, var(--bg) 280px 100%);
      color:var(--text);
    }
    .hero{padding:22px 16px 26px;display:flex;flex-direction:column;align-items:center;gap:10px;color:#fff}
    .logo{display:flex;align-items:center;gap:12px;font-weight:900;letter-spacing:.5px;font-size:44px;text-transform:uppercase}
    .smile{width:52px;height:52px;border-radius:50%;background:#fbbf24;display:grid;place-items:center;color:#0b0b0c;font-weight:900;box-shadow:0 12px 26px rgba(0,0,0,.35)}
    .subtitle{font-weight:800;opacity:.9;letter-spacing:.2em}
    .wrap{max-width:980px;margin:0 auto;padding:0 12px 40px}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:22px;box-shadow:var(--shadow);overflow:hidden}
    .panel h1{margin:0;padding:22px 18px;text-align:center;font-size:44px;font-weight:900;border-bottom:1px solid var(--line);background:#fff}
    .topbar{display:flex;gap:10px;justify-content:space-between;align-items:center;padding:12px 14px;background:#fff;border-bottom:1px solid var(--line)}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:10px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;color:var(--text);text-decoration:none;font-weight:700;font-size:14px}
    .pill b{font-weight:900}
    .note{padding:10px 14px;color:var(--muted);font-size:13px;border-bottom:1px solid var(--line)}
    .grid{display:grid;grid-template-columns:1fr;gap:0}
    .item{display:grid;grid-template-columns:120px 1fr;gap:18px;padding:18px;align-items:center;border-top:1px solid var(--line);background:#fff}
    .item:first-child{border-top:none}
    .poster{width:120px;height:120px;border-radius:12px;overflow:hidden;background:#111;display:grid;place-items:center;color:#fff;box-shadow:0 10px 18px rgba(0,0,0,.15)}
    .poster img{width:100%;height:100%;object-fit:cover;display:block}
    .title{font-size:34px;font-weight:900;line-height:1.05;margin:0 0 8px}
    .meta{color:var(--text);font-weight:800;margin:0 0 14px;font-size:18px}
    .meta span{display:block;font-weight:600;color:var(--text);opacity:.9}
    .buy{display:inline-flex;align-items:center;justify-content:center;width:min(520px,100%);height:66px;background:linear-gradient(180deg,#1a1a1b,#000);color:#fff;border:none;border-radius:12px;font-weight:900;font-size:20px;letter-spacing:.02em;cursor:pointer;box-shadow:0 16px 30px rgba(0,0,0,.18);transition:transform .08s ease;text-decoration:none}
    .buy:active{transform:scale(.99)}
    @media (max-width:520px){
      .logo{font-size:40px}
      .panel h1{font-size:42px}
      .item{grid-template-columns:110px 1fr}
      .poster{width:110px;height:110px}
      .title{font-size:30px}
    }

    /* Support */
    .supportBtn{
      position:fixed; right:18px; bottom:18px; width:68px; height:68px;
      border-radius:50%; border:none; cursor:pointer;
      background:radial-gradient(circle at 30% 30%, #60a5fa, #2563eb 55%, #1d4ed8 100%);
      box-shadow:0 18px 40px rgba(0,0,0,.25);
      display:grid; place-items:center; z-index:9999;
    }
    .supportBtn svg{width:34px;height:34px;fill:#fff}
    .chat{
      position:fixed; right:18px; bottom:96px; width:min(360px, calc(100vw - 36px));
      background:#fff; border:1px solid var(--line); border-radius:16px;
      box-shadow:0 20px 50px rgba(0,0,0,.22);
      overflow:hidden; z-index:9999; display:none;
    }
    .chatHeader{background:#0b0b0c;color:#fff;padding:12px 12px;display:flex;align-items:center;justify-content:space-between;font-weight:900}
    .chatHeader button{background:transparent;border:none;color:#fff;font-size:18px;cursor:pointer}
    .chatBody{padding:12px;max-height:320px;overflow:auto;display:flex;flex-direction:column;gap:10px}
    .msg{padding:10px 12px;border-radius:14px;max-width:90%;font-size:14px;line-height:1.35}
    .me{background:#111827;color:#fff;align-self:flex-end}
    .bot{background:#f3f4f6;color:#111827;border:1px solid #e5e7eb}
    .chatActions{display:flex;gap:8px;padding:10px 12px;border-top:1px solid var(--line);background:#fff}
    .chatActions input{flex:1;padding:12px 12px;border:1px solid var(--line);border-radius:12px;outline:none;font-weight:600}
    .chatActions button{padding:12px 14px;border:none;border-radius:12px;background:#0b0b0c;color:#fff;font-weight:900;cursor:pointer}
    .quick{display:flex;flex-wrap:wrap;gap:8px}
    .quick button{border:1px solid var(--line);background:#fff;border-radius:999px;padding:8px 10px;cursor:pointer;font-weight:700;font-size:12px}
  </style>
</head>
<body>
  <header class="hero">
    <div class="logo">–ê–§–ò–®–ê <div class="smile">‚ò∫</div></div>
    <div class="subtitle">–¢–ï–ê–¢–†</div>
  </header>

  <div class="wrap">
    <section class="panel">
      <div class="topbar">
        <a class="pill" href="wallet.html">üí≥ <span>–ö–æ—à–µ–ª—ë–∫</span> <b id="bal">0 ‚ÇΩ</b></a>
        <a class="pill" href="admin.html">‚öôÔ∏è <span>–ê–¥–º–∏–Ω</span></a>
      </div>
      <div class="note">–°–ø–µ–∫—Ç–∞–∫–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è –¥–æ –∫–æ–Ω—Ü–∞ –º–µ—Å—è—Ü–∞. –í –∞–¥–º–∏–Ω–∫–µ –º–æ–∂–Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å –ª—é–±–æ–π –¥–µ–Ω—å.</div>
      <h1>–¢–µ–∞—Ç—Ä</h1>
      <div id="list" class="grid"></div>
    </section>
  </div>

  <!-- Support -->
  <button class="supportBtn" id="supportBtn" aria-label="Support">
    <svg viewBox="0 0 24 24"><path d="M12 3C7.03 3 3 6.58 3 11c0 2.05.87 3.92 2.3 5.33L4.5 20.5l4.38-1.46c.98.29 2.03.46 3.12.46 4.97 0 9-3.58 9-8s-4.03-8-9-8zm-4 9h8a1 1 0 0 1 0 2H8a1 1 0 0 1 0-2zm0-3h8a1 1 0 1 1 0 2H8a1 1 0 0 1 0-2z"/></svg>
  </button>
  <div class="chat" id="chat">
    <div class="chatHeader">
      <div>Support</div>
      <button id="chatClose">‚úï</button>
    </div>
    <div class="chatBody" id="chatBody"></div>
    <div class="chatBody" style="padding-top:0">
      <div class="quick">
        <button data-q="–ö–∞–∫ –∫—É–ø–∏—Ç—å?">–ö–∞–∫ –∫—É–ø–∏—Ç—å?</button>
        <button data-q="–ù–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–ø–ª–∞—Ç–∞">–ù–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–ø–ª–∞—Ç–∞</button>
        <button data-q="–ù—É–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç">–ù—É–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç</button>
        <button data-q="–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
      </div>
    </div>
    <div class="chatActions">
      <input id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."/>
      <button id="chatSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>

<script>
  // FORCE RESET (—É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ) + —É–≤–æ–¥–∏—Ç –æ—Ç –∫—ç—à–∞
const p = new URLSearchParams(location.search);
if (p.get("reset") === "1") {
  localStorage.clear();
  location.replace("index.html?v=2");
}
const K = {
  EVENTS:"THEATRE_EVENTS_V2",
  BAL:"THEATRE_BALANCE_V1",
  HIDDEN:"THEATRE_HIDDEN_EVENTS_V2",
  SUPPORT:"THEATRE_SUPPORT_TICKETS_V1",
  MONTH:"THEATRE_MONTH_MARK_V2",
};

function rub(n){ return (n||0).toLocaleString("ru-RU")+" ‚ÇΩ"; }

function yyyy_mm(){ const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`; }
function resetIfNewMonth(){
  const mark = localStorage.getItem(K.MONTH);
  const cur = yyyy_mm();
  if(mark !== cur){
    localStorage.setItem(K.MONTH, cur);
    localStorage.removeItem(K.HIDDEN);
    // —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–¥–∏–º (—á—Ç–æ–±—ã –Ω–æ–≤—ã–π –º–µ—Å—è—Ü –æ—Ç 1 —á–∏—Å–ª–∞)
    localStorage.removeItem(K.EVENTS);
  }
}

function rangeToEndOfMonth(){
  const now=new Date();
  const start=new Date(now.getFullYear(),now.getMonth(),now.getDate());
  const end=new Date(now.getFullYear(),now.getMonth()+1,0);
  return {start,end};
}
function iso(d){ return d.toISOString().slice(0,10); }
function formatRU(isoDate){
  const [y,m,d]=isoDate.split("-");
  return `${d}.${m}.${y}`;
}

function seededRand(str){
  // –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π "—Ä–∞–Ω–¥–æ–º" –æ—Ç —Å—Ç—Ä–æ–∫–∏ (—á—Ç–æ–±—ã –∫–∞—Ä—Ç–∏–Ω–∫–∏/—Ç–µ–∫—Å—Ç—ã –Ω–µ –ø—Ä—ã–≥–∞–ª–∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑)
  let h=2166136261>>>0;
  for(let i=0;i<str.length;i++){ h^=str.charCodeAt(i); h=Math.imul(h,16777619); }
  return ()=>{ h+=h<<13; h^=h>>>7; h+=h<<3; h^=h>>>17; h+=h<<5; return ((h>>>0)%100000)/100000; };
}

function seedEventsIfMissing(){
  if(localStorage.getItem(K.EVENTS)) return;

  // —à–∞–±–ª–æ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏–π –∏ –æ–ø–∏—Å–∞–Ω–∏–π (–¥–ª–∏–Ω–Ω—ã–µ, —Ä–∞–∑–Ω—ã–µ)
  const titles = [
    "–î—è–¥—è –í–∞–Ω—è","–ì–µ—Ä–æ–π –Ω–∞—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏","–õ–æ–Ω–¥–æ–Ω —à–æ—É","–ú–µ—á—Ç—ã –æ–∂–∏–≤–∞—é—Ç","–ñ–µ–Ω–∏—Ç—å–±–∞ –§–∏–≥–∞—Ä–æ",
    "–¢—ë–º–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞","–ì–æ—Ä–æ–¥ –±–µ–∑ —Å–Ω–∞","–ü–∏—Å—å–º–∞ –≤ —Ç–∏—à–∏–Ω—É","–ù–æ—á–Ω–æ–π —ç–∫—Å–ø—Ä–µ—Å—Å","–ö–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–∞–≤–¥–∞",
    "–°–µ–¥—å–º–æ–π —Ä—è–¥","–°–≤–µ—Ç —Å–æ —Å—Ü–µ–Ω—ã","–¢–æ–Ω–∫–∞—è –ª–∏–Ω–∏—è","–ü–æ—Ä—Ç—Ä–µ—Ç –≤–µ—Ç—Ä–∞","–°—Ç—Ä–∞–Ω–Ω—ã–π –≤–µ—á–µ—Ä",
    "–¢—Ä–∏ —à–∞–≥–∞ –¥–æ –≤–µ—Å–Ω—ã","–í–Ω—É—Ç—Ä–∏ –º—É–∑—ã–∫–∏","–¢–µ–∞—Ç—Ä —Ç–µ–Ω–µ–π","–û—Å–∫–æ–ª–∫–∏ –ø–∞–º—è—Ç–∏","–ù–µ–≤–∏–¥–∏–º—ã–π –¥–∏–∞–ª–æ–≥",
  ];

  const posters = [
    "https://images.unsplash.com/photo-1529156069898-49953e39b3ac?auto=format&fit=crop&w=800&q=70",
    "https://images.unsplash.com/photo-1520697830682-bbb6e85e2b0d?auto=format&fit=crop&w=800&q=70",
    "https://images.unsplash.com/photo-1521336575822-6da63fb45455?auto=format&fit=crop&w=800&q=70",
    "https://images.unsplash.com/photo-1515168833906-d2a3b82b302a?auto=format&fit=crop&w=800&q=70",
    "https://images.unsplash.com/photo-1507924538820-ede94a04019d?auto=format&fit=crop&w=800&q=70",
    "https://images.unsplash.com/photo-1526481280695-3c687fd5432c?auto=format&fit=crop&w=800&q=70",
    "https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?auto=format&fit=crop&w=800&q=70"
  ];

  const descriptions = [
`–¢—ã —Ç–æ—Ç, –≤–æ —á—Ç–æ —Ç—ã –≤–µ—Ä–∏—à—å. –ù–æ –Ω–∞—Å–∫–æ–ª—å–∫–æ –∑—Ä—è—á–∞ –¥—É—à–∞ –∏ –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–ª–µ–ø—ã –≥–ª–∞–∑–∞?
–ö—É–¥–∞ –º–æ–∂–µ—Ç –∑–∞–≤–µ—Å—Ç–∏ –≤–µ—Ä–∞ –∏ —á—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Å–ª–µ–ø–æ–π –ø—Ä–æ–∑—Ä–µ–ª. –ú—É—á–∏—Ç–µ–ª—å–Ω—ã–π –∏ —Å–ª–æ–∂–Ω—ã–π –ø—É—Ç—å
–æ—Ç –≤–æ–ø—Ä–æ—Å–∞ –∫ –æ—Ç–≤–µ—Ç—É –ø—Ä–æ—Ö–æ–¥—è—Ç –≥–µ—Ä–æ–∏, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—ã—à–∏—Ç –ø—Ä–∞–≤–¥—É –ø–æ-—Å–≤–æ–µ–º—É.
–≠—Ç–æ—Ç —Å–ø–µ–∫—Ç–∞–∫–ª—å ‚Äî –ø—Ä–æ –≤–ª–∞—Å—Ç—å –ø—Ä–∏–≤—ã—á–µ–∫, –ø—Ä–æ —Å–ª–∞–±–æ—Å—Ç—å —Å–∏–ª—ã –∏ –ø—Ä–æ —Ç–æ, –∫–∞–∫ —Ç–∏—à–∏–Ω–∞ –∏–Ω–æ–≥–¥–∞ –≥—Ä–æ–º—á–µ —Å–ª–æ–≤.`,
`–ö–æ–º–µ–¥–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —á–∞—Å–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º: —Å—Ü–µ–Ω—ã —Å–º–µ–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ, —Ä–µ–ø–ª–∏–∫–∏ —Ç–æ—á–Ω—ã,
–∞ —Å–º–µ—Ö –≤–Ω–µ–∑–∞–ø–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–µ—Ä—å—ë–∑–Ω—ã–º. –ù–æ –≥–ª–∞–≤–Ω—ã–π —Å–µ–∫—Ä–µ—Ç —É—Å–ø–µ—Ö–∞ ‚Äî –≤ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–µ –≥–µ—Ä–æ—è:
—Ç–∞–ª–∞–Ω—Ç–ª–∏–≤—ã–π, –∂–∏–≤–æ–π, –Ω–µ—É–¥–æ–±–Ω—ã–π, –æ–Ω —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞ –ø—ã—Ç–∞–µ—Ç—Å—è —É–¥–µ—Ä–∂–∞—Ç—å —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ —Ç–∞–º,
–≥–¥–µ –æ–Ω–æ –Ω–∏–∫–æ–º—É –Ω–µ –≤—ã–≥–æ–¥–Ω–æ. –ò –∏–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –º—ã —É–∑–Ω–∞—ë–º –≤ –Ω—ë–º —Å–µ–±—è.`,
`–ò—Å—Ç–æ—Ä–∏—è –æ —Ç–æ–º, –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫ —É—á–∏—Ç—Å—è –±—ã—Ç—å —á–µ—Å—Ç–Ω—ã–º ‚Äî –Ω–µ —Å –¥—Ä—É–≥–∏–º–∏, –∞ —Å —Å–æ–±–æ–π.
–ó–¥–µ—Å—å –Ω–µ—Ç ‚Äú–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö‚Äù –æ—Ç–≤–µ—Ç–æ–≤, –∑–∞—Ç–æ –µ—Å—Ç—å —Ç–æ—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã: —á—Ç–æ –º—ã –≤—ã–±–∏—Ä–∞–µ–º,
–∫–æ–≥–¥–∞ –Ω–∏–∫—Ç–æ –Ω–µ —Å–º–æ—Ç—Ä–∏—Ç? –ß—Ç–æ –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç –ª—é–±–≤–∏, –µ—Å–ª–∏ –≤—ã–Ω—É—Ç—å –∏–∑ –Ω–µ—ë —Å—Ç—Ä–∞—Ö?
–°–ø–µ–∫—Ç–∞–∫–ª—å –∑–≤—É—á–∏—Ç –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–Ω–µ–≤–Ω–∏–∫ ‚Äî –∏ –∏–Ω–æ–≥–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç —Ç–æ—á–Ω–æ –≤ —Å–µ—Ä–¥—Ü–µ.`,
`–≠—Ç–æ —Å–ø–µ–∫—Ç–∞–∫–ª—å –æ –ø–∞–º—è—Ç–∏: –æ–Ω–∞ —É–º–µ–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–≤–µ—Ç –∏ —É–º–µ–µ—Ç —Ä–∞–Ω–∏—Ç—å.
–í –æ–±—ã—á–Ω–æ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–µ –≤–¥—Ä—É–≥ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–∞—É–∑–∞, –∏ –≤ —ç—Ç–æ–π –ø–∞—É–∑–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Ü–µ–ª–∞—è –∂–∏–∑–Ω—å.
–ú—É–∑—ã–∫–∞, –≤–∑–≥–ª—è–¥, —à–∞–≥ ‚Äî –≤—Å—ë —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∞–∂–Ω—ã–º. –ê —Å—Ü–µ–Ω–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∫–æ–º–Ω–∞—Ç—É,
–≥–¥–µ –∫–∞–∂–¥—ã–π —É–∑–Ω–∞–µ—Ç —Å–≤–æ—é –∏—Å—Ç–æ—Ä–∏—é, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –æ –Ω–µ–π –Ω–µ –≥–æ–≤–æ—Ä–∏–ª.`,
`–ù–µ–∂–Ω–∞—è, –Ω–æ –æ—Å—Ç—Ä–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ –≤—ã–±–æ—Ä–µ –∏ —Ü–µ–Ω–µ –≤—ã–±–æ—Ä–∞.
–ì–µ—Ä–æ–∏ –±–µ–≥—É—Ç –æ—Ç —Å–µ–±—è, —Å–ø–æ—Ä—è—Ç —Å —Å—É–¥—å–±–æ–π, —Å–º–µ—é—Ç—Å—è –Ω–∞–¥ —Å—Ç—Ä–∞—Ö–æ–º, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ
–∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É: —á—Ç–æ –≤–∞–∂–Ω–µ–µ ‚Äî –ø–æ–±–µ–¥–∏—Ç—å –∏–ª–∏ –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –≥–ª–∞–≤–Ω–æ–µ?
–ò –∫–æ–≥–¥–∞ –∑–∞–Ω–∞–≤–µ—Å –æ–ø—É—Å–∫–∞–µ—Ç—Å—è, —Ç—ã –≤—ã—Ö–æ–¥–∏—à—å –¥—Ä—É–≥–∏–º ‚Äî —á—É—Ç—å —Ç–∏—à–µ, –Ω–æ —è—Å–Ω–µ–µ.`
  ];

  const aboutTemplate = () => ({
    director:"–ï–≤–≥–µ–Ω–∏–π –ü–∏—Å–∞—Ä–µ–≤",
    artist:"–ê–Ω–¥—Ä–µ–∞—Å —Ñ–æ–Ω –®–ª–∏–ø–ø–µ",
    producer:"–í–ª–∞–¥–∏–º–∏—Ä –ü—Ä—É–¥–∫–∏–Ω",
    music:"–¢–∏–º—É—Ä –ü–æ–ª—è–Ω—Å–∫–∏–π",
    light:"–°–µ—Ä–≥–µ–π –ù–µ–≤–≥–∞–¥–æ–≤—Å–∫–∏–π",
    ballet:"–ê–Ω–∂–µ–ª–∏–∫–∞ –ë–æ—Ä–∏—Å–æ–≤–∞",
    sound:"–°–µ—Ä–≥–µ–π –®–µ–≤—á–µ–Ω–∫–æ",
    video:"–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë—Ä–∞—Ç–∏–Ω–æ–≤",
    assistant:"–õ—é–±–æ–≤—å –°–∫–∏—Ä–∫–æ",
  });

  const castPool = [
    ["–ò—Ä–∏–Ω–∞ –ì—Ä–∏—â–µ–Ω–∫–æ","–ö–∞—Ä–µ–Ω –°—Ç–æ—É–Ω"],
    ["–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –¢–µ–º–ª—è–∫","–ü–∞–æ–ª–æ"],
    ["–ò—Ä–∏–Ω–∞ –ú–µ–ª—å–Ω–∏–∫","–ì—Ä–∞—Ñ–∏–Ω—è"],
    ["–Æ–ª–∏—è –ë—Ä—É—Å–µ–Ω—Ü–µ–≤–∞","–°–ª—É–≥–∏ –ø—Ä–æ—Å—Ü–µ–Ω–∏—É–º–∞"],
    ["–°–µ—Ä–≥–µ–π –ù–µ–≤–≥–∞–¥–æ–≤—Å–∫–∏–π","–ê—Å—Ç—Ä–æ–≤"],
    ["–ê–Ω–Ω–∞ –†–æ–º–∞–Ω–æ–≤–∞","–í–µ—Ä–∞"],
    ["–ö–∏—Ä–∏–ª–ª –õ–µ–±–µ–¥–µ–≤","–ì—Ä—É—à–Ω–∏—Ü–∫–∏–π"],
    ["–û–ª—å–≥–∞ –°–µ–ª–µ–∑–Ω—ë–≤–∞","–ú–µ—Ä–∏"],
    ["–ú–∏—Ö–∞–∏–ª –ù–∞–∑–∞—Ä–æ–≤","–ü–µ—á–æ—Ä–∏–Ω"],
    ["–ü–∞–≤–µ–ª –ò–ª—å–∏–Ω","–í–µ–¥—É—â–∏–π"],
    ["–ö—Å–µ–Ω–∏—è –ê—Ä—Ç–µ–º—å–µ–≤–∞","–ì–æ—Å—Ç—å—è"],
    ["–ò–≥–æ—Ä—å –°–∞—Ñ–æ–Ω–æ–≤","–ö–æ–º–∏–∫"]
  ];

  const times = ["18:00","19:00","20:00","21:00","22:00"];

  const {start,end} = rangeToEndOfMonth();
  const events = [];
  let idx=0;

  for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1)){
    // –≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å —Å–¥–µ–ª–∞–µ–º 2 —Å–ø–µ–∫—Ç–∞–∫–ª—è (–º–Ω–æ–≥–æ —Å–ø–µ–∫—Ç–∞–∫–ª–µ–π)
    for(let k=0;k<2;k++){
      const dateISO = iso(d);
      const id = `e_${dateISO}_${k}`;
      const r = seededRand(id);

      const title = titles[(idx + Math.floor(r()*titles.length)) % titles.length] + (k===1 ? " ‚Äî –í–µ—á–µ—Ä" : "");
      const poster = posters[Math.floor(r()*posters.length)];
      const desc = descriptions[Math.floor(r()*descriptions.length)];
      const t = times[Math.floor(r()*times.length)]; // –æ–¥–Ω–æ –≤—Ä–µ–º—è –≤ –¥–µ–Ω—å (–≤ —Å–æ–±—ã—Ç–∏–∏)
      // 4 –∞–∫—Ç—ë—Ä–∞
      const cast = [];
      const used = new Set();
      while(cast.length<4){
        const pick = castPool[Math.floor(r()*castPool.length)];
        const key = pick[0]+"|"+pick[1];
        if(used.has(key)) continue;
        used.add(key);
        cast.push({actor:pick[0], role:pick[1]});
      }

      events.push({
        id,
        title,
        city:"–ú–æ—Å–∫–≤–∞",
        venue:"–ú–æ—Å–∫–≤–∞, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è 6",
        date: dateISO,
        time: t,
        poster,
        about: aboutTemplate(),
        cast,
        description: desc
      });
      idx++;
    }
  }

  localStorage.setItem(K.EVENTS, JSON.stringify({events}));
}

function loadEvents(){ return JSON.parse(localStorage.getItem(K.EVENTS)); }
function hiddenSet(){ return new Set(JSON.parse(localStorage.getItem(K.HIDDEN)||"[]")); }

function render(){
  const bal = Number(localStorage.getItem(K.BAL) || "0");
  document.getElementById("bal").textContent = rub(bal);

  const list=document.getElementById("list");
  list.innerHTML="";

  const {events} = loadEvents();
  const hidden = hiddenSet();

  const visible = events.filter(e=>!hidden.has(e.id));
  visible.forEach(e=>{
    const card=document.createElement("div");
    card.className="item";
    card.innerHTML = `
      <div class="poster"><img alt="" src="${e.poster}"></div>
      <div>
        <div class="title">${e.title}</div>
        <div class="meta">${e.city}, <span>${formatRU(e.date)}, ${e.time},</span></div>
        <a class="buy" href="show.html?id=${encodeURIComponent(e.id)}">–ö—É–ø–∏—Ç—å</a>
      </div>
    `;
    list.appendChild(card);
  });

  if(!visible.length){
    list.innerHTML = `<div style="padding:22px;color:#6b7280;font-weight:700">–ù–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–µ–∫—Ç–∞–∫–ª–µ–π (–≤–æ–∑–º–æ–∂–Ω–æ, –≤—Å—ë —Å–∫—Ä—ã—Ç–æ –≤ –∞–¥–º–∏–Ω–∫–µ).</div>`;
  }
}

/** SUPPORT BOT */
const chat=document.getElementById("chat");
const body=document.getElementById("chatBody");
function addMsg(text, who="bot"){
  const div=document.createElement("div");
  div.className="msg "+(who==="me"?"me":"bot");
  div.textContent=text;
  body.appendChild(div);
  body.scrollTop=body.scrollHeight;
}
function botReply(q){
  const t=q.toLowerCase();
  if(t.includes("–∫–∞–∫ –∫—É–ø–∏—Ç—å")) return "–û—Ç–∫—Ä–æ–π —Å–ø–µ–∫—Ç–∞–∫–ª—å ‚Üí –≤—ã–±–µ—Ä–∏ –º–µ—Å—Ç–∞ –Ω–∞ —Å—Ö–µ–º–µ ‚Üí –≤–≤–µ–¥–∏ –§–ò–û/—Ç–µ–ª–µ—Ñ–æ–Ω/email ‚Üí –æ–ø–ª–∞—Ç–∏ —Å –∫–æ—à–µ–ª—å–∫–∞.";
  if(t.includes("–Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç")) return "–ü—Ä–æ–≤–µ—Ä—å –±–∞–ª–∞–Ω—Å –≤ ¬´–ö–æ—à–µ–ª—å–∫–µ¬ª. –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Äî –ø–æ–ø–æ–ª–Ω–∏ –ø–æ —Å—Å—ã–ª–∫–µ –æ–ø–ª–∞—Ç—ã.";
  if(t.includes("–≤–æ–∑–≤—Ä–∞—Ç")) return "–î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Å—Ç–∞–≤—å –∑–∞—è–≤–∫—É: –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç–∞/–≤—Ä–µ–º—è —Å–ø–µ–∫—Ç–∞–∫–ª—è.";
  if(t.includes("–∑–∞—è–≤–∫")) return "–ù–∞–ø–∏—à–∏: –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, –ø—Ä–æ–±–ª–µ–º—É. –Ø —Å–æ—Ö—Ä–∞–Ω—é –∑–∞—è–≤–∫—É –∏ –ø–µ—Ä–µ–¥–∞–º –∞–¥–º–∏–Ω—É.";
  return "–ü–æ–Ω—è–ª. –ù–∞–ø–∏—à–∏ —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî –ø–æ–º–æ–≥—É üôÇ";
}
function saveTicket(text){
  const arr=JSON.parse(localStorage.getItem(K.SUPPORT)||"[]");
  arr.push({ts:Date.now(), text});
  localStorage.setItem(K.SUPPORT, JSON.stringify(arr));
}
document.getElementById("supportBtn").onclick=()=>{
  chat.style.display = (!chat.style.display || chat.style.display==="none") ? "block" : "none";
  if(!body.children.length) addMsg("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø support. –ß–µ–º –ø–æ–º–æ—á—å?");
};
document.getElementById("chatClose").onclick=()=> chat.style.display="none";
document.getElementById("chatSend").onclick=()=>{
  const inp=document.getElementById("chatInput");
  const q=inp.value.trim();
  if(!q) return;
  addMsg(q,"me"); inp.value="";
  addMsg(botReply(q),"bot");
  if(q.toLowerCase().includes("–∑–∞—è–≤–∫") || q.toLowerCase().includes("—Ñ–∏–æ") || q.toLowerCase().includes("—Ç–µ–ª")) saveTicket(q);
};
document.getElementById("chatInput").addEventListener("keydown",(e)=>{ if(e.key==="Enter") document.getElementById("chatSend").click(); });
document.querySelectorAll(".quick button").forEach(b=>{
  b.onclick=()=>{ document.getElementById("chatInput").value=b.dataset.q; document.getElementById("chatSend").click(); };
});

/** INIT */
resetIfNewMonth();
seedEventsIfMissing();
render();
</script>
</body>
</html>
