<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ê–§–ò–®–ê ‚Äî –¢–µ–∞—Ç—Ä</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f3f4f6; --card:#fff; --text:#0b0b0c; --muted:#6b7280;
      --line:#e5e7eb; --shadow:0 18px 40px rgba(0,0,0,.12);
      --btn:#0b0b0c;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(#0b0b0c 0 280px, var(--bg) 280px 100%);
      color:var(--text);
    }
    .hero{
      padding:22px 16px 26px;
      display:flex; flex-direction:column; align-items:center; gap:10px;
      color:#fff;
    }
    .logo{
      display:flex; align-items:center; gap:12px;
      font-weight:900; letter-spacing:.5px; font-size:44px;
      text-transform:uppercase;
    }
    .smile{
      width:52px; height:52px; border-radius:50%;
      background:#fbbf24; display:grid; place-items:center;
      color:#0b0b0c; font-weight:900;
      box-shadow:0 12px 26px rgba(0,0,0,.35);
    }
    .subtitle{font-weight:800; opacity:.9; letter-spacing:.2em}
    .wrap{max-width:980px; margin:0 auto; padding:0 12px 40px}
    .panel{
      background:var(--card); border:1px solid var(--line); border-radius:22px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .panel h1{
      margin:0; padding:22px 18px; text-align:center; font-size:44px; font-weight:900;
      border-bottom:1px solid var(--line);
      background:#fff;
    }
    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:0;
    }
    .item{
      display:grid;
      grid-template-columns:120px 1fr;
      gap:18px;
      padding:18px;
      align-items:center;
      border-top:1px solid var(--line);
      background:#fff;
    }
    .item:first-child{border-top:none}
    .poster{
      width:120px; height:120px; border-radius:12px;
      overflow:hidden; background:#111;
      display:grid; place-items:center; color:#fff;
      box-shadow:0 10px 18px rgba(0,0,0,.15);
    }
    .poster img{width:100%;height:100%;object-fit:cover;display:block}
    .title{
      font-size:34px; font-weight:900; line-height:1.05; margin:0 0 8px;
    }
    .meta{
      color:var(--text);
      font-weight:800;
      margin:0 0 14px;
      font-size:18px;
    }
    .meta span{display:block; font-weight:600; color:var(--text); opacity:.9}
    .buy{
      display:inline-flex; align-items:center; justify-content:center;
      width:min(520px,100%); height:66px;
      background:linear-gradient(180deg,#1a1a1b, #000);
      color:#fff; border:none; border-radius:12px;
      font-weight:900; font-size:20px; letter-spacing:.02em;
      cursor:pointer;
      box-shadow:0 16px 30px rgba(0,0,0,.18);
      transition:transform .08s ease;
      text-decoration:none;
    }
    .buy:active{transform:scale(.99)}
    .topbar{
      display:flex; gap:10px; justify-content:space-between; align-items:center;
      padding:12px 14px; background:#fff; border-bottom:1px solid var(--line);
    }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:10px 12px; border:1px solid var(--line);
      border-radius:999px; background:#fff; color:var(--text);
      text-decoration:none; font-weight:700; font-size:14px;
    }
    .pill b{font-weight:900}
    .note{padding:10px 14px; color:var(--muted); font-size:13px; border-bottom:1px solid var(--line)}
    @media (max-width:520px){
      .logo{font-size:40px}
      .panel h1{font-size:42px}
      .item{grid-template-columns:110px 1fr}
      .poster{width:110px;height:110px}
      .title{font-size:30px}
    }

    /* support button */
    .supportBtn{
      position:fixed; right:18px; bottom:18px; width:68px; height:68px;
      border-radius:50%;
      border:none; cursor:pointer;
      background:radial-gradient(circle at 30% 30%, #60a5fa, #2563eb 55%, #1d4ed8 100%);
      box-shadow:0 18px 40px rgba(0,0,0,.25);
      display:grid; place-items:center;
      z-index:9999;
    }
    .supportBtn svg{width:34px;height:34px;fill:#fff}
    .chat{
      position:fixed; right:18px; bottom:96px; width:min(360px, calc(100vw - 36px));
      background:#fff; border:1px solid var(--line); border-radius:16px;
      box-shadow:0 20px 50px rgba(0,0,0,.22);
      overflow:hidden; z-index:9999; display:none;
    }
    .chatHeader{
      background:#0b0b0c; color:#fff; padding:12px 12px; display:flex; align-items:center; justify-content:space-between;
      font-weight:900;
    }
    .chatHeader button{background:transparent;border:none;color:#fff;font-size:18px;cursor:pointer}
    .chatBody{padding:12px; max-height:320px; overflow:auto; display:flex; flex-direction:column; gap:10px;}
    .msg{padding:10px 12px; border-radius:14px; max-width:90%; font-size:14px; line-height:1.35}
    .me{background:#111827; color:#fff; align-self:flex-end}
    .bot{background:#f3f4f6; color:#111827; border:1px solid #e5e7eb}
    .chatActions{display:flex; gap:8px; padding:10px 12px; border-top:1px solid var(--line); background:#fff}
    .chatActions input{
      flex:1; padding:12px 12px; border:1px solid var(--line); border-radius:12px; outline:none;
      font-weight:600;
    }
    .chatActions button{
      padding:12px 14px; border:none; border-radius:12px; background:#0b0b0c; color:#fff; font-weight:900; cursor:pointer;
    }
    .quick{
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .quick button{
      border:1px solid var(--line); background:#fff; border-radius:999px; padding:8px 10px; cursor:pointer;
      font-weight:700; font-size:12px;
    }
  </style>
</head>
<body>

  <header class="hero">
    <div class="logo">–ê–§–ò–®–ê <div class="smile">‚ò∫</div></div>
    <div class="subtitle">–¢–ï–ê–¢–†</div>
  </header>

  <div class="wrap">
    <section class="panel">
      <div class="topbar">
        <a class="pill" href="wallet.html">üí≥ <span>–ö–æ—à–µ–ª—ë–∫</span> <b id="bal">0 ‚ÇΩ</b></a>
        <a class="pill" href="admin.html">‚öôÔ∏è <span>–ê–¥–º–∏–Ω</span></a>
      </div>
      <div class="note">–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–∞—Ç—ã —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è –¥–æ –∫–æ–Ω—Ü–∞ –º–µ—Å—è—Ü–∞. –í –∞–¥–º–∏–Ω–∫–µ –º–æ–∂–Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å –¥–Ω–∏.</div>
      <h1>–¢–µ–∞—Ç—Ä</h1>
      <div id="list" class="grid"></div>
    </section>
  </div>

  <!-- Support -->
  <button class="supportBtn" id="supportBtn" aria-label="Support">
    <svg viewBox="0 0 24 24"><path d="M12 3C7.03 3 3 6.58 3 11c0 2.05.87 3.92 2.3 5.33L4.5 20.5l4.38-1.46c.98.29 2.03.46 3.12.46 4.97 0 9-3.58 9-8s-4.03-8-9-8zm-4 9h8a1 1 0 0 1 0 2H8a1 1 0 0 1 0-2zm0-3h8a1 1 0 1 1 0 2H8a1 1 0 0 1 0-2z"/></svg>
  </button>
  <div class="chat" id="chat">
    <div class="chatHeader">
      <div>Support</div>
      <button id="chatClose">‚úï</button>
    </div>
    <div class="chatBody" id="chatBody"></div>
    <div class="chatBody" style="padding-top:0">
      <div class="quick">
        <button data-q="–ö–∞–∫ –∫—É–ø–∏—Ç—å?">–ö–∞–∫ –∫—É–ø–∏—Ç—å?</button>
        <button data-q="–ù–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–ø–ª–∞—Ç–∞">–ù–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–ø–ª–∞—Ç–∞</button>
        <button data-q="–ù—É–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç">–ù—É–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—Ç</button>
        <button data-q="–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
      </div>
    </div>
    <div class="chatActions">
      <input id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."/>
      <button id="chatSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>

<script>
/** ==========================
 *  STORAGE KEYS
 * ========================== */
const K = {
  DATA: "THEATRE_DATA_V1",
  BAL: "THEATRE_BALANCE_V1",
  HIDDEN_DAYS: "THEATRE_HIDDEN_DAYS_V1",
  BOOKINGS: "THEATRE_BOOKINGS_V1",
  SUPPORT: "THEATRE_SUPPORT_TICKETS_V1",
  MONTH: "THEATRE_MONTH_MARK_V1",
};

function rub(n){ return (n||0).toLocaleString("ru-RU") + " ‚ÇΩ"; }

function todayRangeToEndOfMonth(){
  const now = new Date();
  const start = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const end = new Date(now.getFullYear(), now.getMonth()+1, 0); // last day
  return {start, end};
}
function yyyy_mm(){
  const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;
}
function resetIfNewMonth(){
  const mark = localStorage.getItem(K.MONTH);
  const cur = yyyy_mm();
  if(mark !== cur){
    localStorage.setItem(K.MONTH, cur);
    localStorage.removeItem(K.HIDDEN_DAYS);
    // –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –æ—á–∏—Å—Ç–∏—Ç—å –±—Ä–æ–Ω–∏ –ø–æ –∂–µ–ª–∞–Ω–∏—é ‚Äî –Ω–æ –æ—Å—Ç–∞–≤–∏–º, —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é.
  }
}

function seedDataIfMissing(){
  if(localStorage.getItem(K.DATA)) return;

  const shows = [
    {
      id:"vanya",
      title:"–î—è–¥—è –í–∞–Ω—è",
      city:"–ú–æ—Å–∫–≤–∞",
      venue:"–ú–æ—Å–∫–≤–∞, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è 6",
      poster:"https://images.unsplash.com/photo-1529156069898-49953e39b3ac?auto=format&fit=crop&w=800&q=70",
      about:{
        director:"–ò–ª—å—è –°–æ–∫–æ–ª–æ–≤",
        artist:"–ú–∞—Ä–∏–Ω–∞ –ö—É–∑–Ω–µ—Ü–æ–≤–∞",
        costume:"–û–ª—å–≥–∞ –ú–∏—Ä–æ–Ω–æ–≤–∞",
        music:"–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤",
        ballet:"–í–∏–∫—Ç–æ—Ä–∏—è –í–æ–ª–∫–æ–≤–∞",
        assistant:"–î–∞—Ä—å—è –ó–∞–π—Ü–µ–≤–∞",
      },
      cast:[
        {actor:"–ò—Ä–∏–Ω–∞ –ì—Ä–∏—â–µ–Ω–∫–æ", role:"–ï–ª–µ–Ω–∞ –ê–Ω–¥—Ä–µ–µ–≤–Ω–∞"},
        {actor:"–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –¢–µ–º–ª—è–∫", role:"–î–æ–∫—Ç–æ—Ä –ê—Å—Ç—Ä–æ–≤"},
        {actor:"–Æ–ª–∏—è –ë—Ä—É—Å–µ–Ω—Ü–µ–≤–∞", role:"–°–æ–Ω—è"},
        {actor:"–°–µ—Ä–≥–µ–π –ù–µ–≤–≥–∞–¥–æ–≤—Å–∫–∏–π", role:"–í–æ–π–Ω–∏—Ü–∫–∏–π"},
      ],
      description:
`–¢—ã —Ç–æ—Ç, –≤–æ —á—Ç–æ —Ç—ã –≤–µ—Ä–∏—à—å. –ù–æ –Ω–∞—Å–∫–æ–ª—å–∫–æ –∑—Ä—è—á–∞ –¥—É—à–∞ –∏ –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–ª–µ–ø—ã –≥–ª–∞–∑–∞?
–ö—É–¥–∞ –º–æ–∂–µ—Ç –∑–∞–≤–µ—Å—Ç–∏ –≤–µ—Ä–∞ –∏ —á—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Å–ª–µ–ø–æ–π –ø—Ä–æ–∑—Ä–µ–ª. –ú—É—á–∏—Ç–µ–ª—å–Ω—ã–π –∏ —Å–ª–æ–∂–Ω—ã–π –ø—É—Ç—å
–æ—Ç –≤–æ–ø—Ä–æ—Å–∞ –∫ –æ—Ç–≤–µ—Ç—É –ø—Ä–æ—Ö–æ–¥—è—Ç –∏ ¬´–≤–ø–∞–≤—à–∏–π –≤ –≥–ª—É–ø–æ—Å—Ç—å¬ª –õ–∏—Ä, –∏ ¬´–∫—Ä–æ–≤–∞–≤–æ–≥–ª–∞–∑—ã–π¬ª –ì–ª–æ—Å—Ç–µ—Ä.
–¢—Ä–∞–≥–µ–¥–∏—è –∫–æ—Ä–æ–ª—è, —á—å—è –∏–∑—É—Ä–æ–¥–æ–≤–∞–Ω–Ω–∞—è –≤–ª–∞—Å—Ç—å—é –¥—É—à–∞ –æ—Å–ª–µ–ø–ª—è–µ—Ç —Ä–∞–∑—É–º, –∑–≤—É—á–∏—Ç –≤ —É–Ω–∏—Å–æ–Ω
—Å —Ç—Ä–∞–≥–µ–¥–∏–µ–π –ì–ª–æ—Å—Ç–µ—Ä–∞, –æ—Å–ª–µ–ø–ª—ë–Ω–Ω–æ–≥–æ, –Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –ø—Ä–æ–∑—Ä–µ–≤–∞—é—â–µ–≥–æ –¥—É—à–æ–π.`
    },
    {
      id:"hero",
      title:"–ì–µ—Ä–æ–π –Ω–∞—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏",
      city:"–ú–æ—Å–∫–≤–∞",
      venue:"–ú–æ—Å–∫–≤–∞, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è 6",
      poster:"https://images.unsplash.com/photo-1520697830682-bbb6e85e2b0d?auto=format&fit=crop&w=800&q=70",
      about:{
        director:"–ï–≤–≥–µ–Ω–∏–π –ü–∏—Å–∞—Ä–µ–≤",
        artist:"–ê–Ω–¥—Ä–µ–∞—Å —Ñ–æ–Ω –®–ª–∏–ø–ø–µ",
        producer:"–í–ª–∞–¥–∏–º–∏—Ä –ü—Ä—É–¥–∫–∏–Ω",
        music:"–¢–∏–º—É—Ä –ü–æ–ª—è–Ω—Å–∫–∏–π",
        light:"–°–µ—Ä–≥–µ–π –ù–µ–≤–≥–∞–¥–æ–≤—Å–∫–∏–π",
        sound:"–°–µ—Ä–≥–µ–π –®–µ–≤—á–µ–Ω–∫–æ",
        video:"–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë—Ä–∞—Ç–∏–Ω–æ–≤",
        assistant:"–õ—é–±–æ–≤—å –°–∫–∏—Ä–∫–æ",
      },
      cast:[
        {actor:"–ú–∏—Ö–∞–∏–ª –ù–∞–∑–∞—Ä–æ–≤", role:"–ü–µ—á–æ—Ä–∏–Ω"},
        {actor:"–ê–Ω–Ω–∞ –†–æ–º–∞–Ω–æ–≤–∞", role:"–í–µ—Ä–∞"},
        {actor:"–ö–∏—Ä–∏–ª–ª –õ–µ–±–µ–¥–µ–≤", role:"–ì—Ä—É—à–Ω–∏—Ü–∫–∏–π"},
        {actor:"–û–ª—å–≥–∞ –°–µ–ª–µ–∑–Ω—ë–≤–∞", role:"–ú–µ—Ä–∏"},
      ],
      description:
`–ò—Å—Ç–æ—Ä–∏—è —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–ª–∏—à–∫–æ–º —Ö–æ—Ä–æ—à–æ –≤–∏–¥–∏—Ç –ª—é–¥–µ–π –∏ —Å–ª–∏—à–∫–æ–º –ø–ª–æ—Ö–æ ‚Äî —Å–µ–±—è.
–°—É–¥—å–±–∞ —Å–≤–æ–¥–∏—Ç –µ–≥–æ —Å –ª—é–±–æ–≤—å—é, —á–µ—Å—Ç–æ–ª—é–±–∏–µ–º –∏ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ–º; –∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑,
–≤—ã–±–∏—Ä–∞—è –≤—ã–∏–≥—Ä—ã—à, –æ–Ω —Ç–µ—Ä—è–µ—Ç –≥–ª–∞–≤–Ω–æ–µ. –°–ø–µ–∫—Ç–∞–∫–ª—å ‚Äî –∫–∞–∫ –¥–Ω–µ–≤–Ω–∏–∫: –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ,
–∂—ë—Å—Ç–∫–æ –∏ –ø–æ-—Å–≤–æ–µ–º—É –Ω–µ–∂–Ω–æ –æ —Ç–æ–º, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ —Å–∏–ª—å–Ω–µ–µ –Ω–∞—Å.`
    },
    {
      id:"london",
      title:"–õ–æ–Ω–¥–æ–Ω —à–æ—É",
      city:"–ú–æ—Å–∫–≤–∞",
      venue:"–ú–æ—Å–∫–≤–∞, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è 6",
      poster:"https://images.unsplash.com/photo-1521336575822-6da63fb45455?auto=format&fit=crop&w=800&q=70",
      about:{
        director:"–ù–∏–∫–∏—Ç–∞ –õ–∞–Ω—Å–∫–æ–π",
        artist:"–ú–∞—Ä–∏—è –í–æ–ª–æ—à–∏–Ω–∞",
        music:"–î–º–∏—Ç—Ä–∏–π –°–µ–≤–µ—Ä",
        sound:"–ê–ª–∏–Ω–∞ –ö–æ–≤–∞–ª—å",
        assistant:"–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ñ–¥–∞–Ω–æ–≤–∞",
      },
      cast:[
        {actor:"–ü–∞–≤–µ–ª –ò–ª—å–∏–Ω", role:"–í–µ–¥—É—â–∏–π"},
        {actor:"–ö—Å–µ–Ω–∏—è –ê—Ä—Ç–µ–º—å–µ–≤–∞", role:"–ì–æ—Å—Ç—å—è"},
        {actor:"–ò–≥–æ—Ä—å –°–∞—Ñ–æ–Ω–æ–≤", role:"–ö–æ–º–∏–∫"},
      ],
      description:
`–°–º–µ—à–Ω–æ–µ –∏ —á–µ—Å—Ç–Ω–æ–µ —à–æ—É –æ —Ç–æ–º, –∫–∞–∫ –º—ã –ø—Ä–∏—Ç–≤–æ—Ä—è–µ–º—Å—è –≤–∑—Ä–æ—Å–ª—ã–º–∏.
–ú—É–∑—ã–∫–∞, –∂–∏–≤—ã–µ —Ä–µ–ø–ª–∏–∫–∏, –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è –∏ –∏—Å—Ç–æ—Ä–∏–∏,
–≤ –∫–æ—Ç–æ—Ä—ã—Ö —É–∑–Ω–∞—ë—à—å —Å–µ–±—è ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ –æ—á–µ–Ω—å –Ω–µ —Ö–æ—á–µ—Ç—Å—è.`
    },
    {
      id:"dreams",
      title:"–ú–µ—á—Ç—ã –æ–∂–∏–≤–∞—é—Ç",
      city:"–ú–æ—Å–∫–≤–∞",
      venue:"–ú–æ—Å–∫–≤–∞, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è 6",
      poster:"https://images.unsplash.com/photo-1515168833906-d2a3b82b302a?auto=format&fit=crop&w=800&q=70",
      about:{
        director:"–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –§–æ–º–∏–Ω",
        artist:"–ï–ª–µ–Ω–∞ –ö–ª–∏–º–æ–≤–∞",
        music:"–ù–∏–∫–æ–ª–∞–π –í–µ—Ç—Ä–æ–≤",
        light:"–ú–∞—Ä–∏–Ω–∞ –°–∏–Ω–∏—Ü—ã–Ω–∞",
        assistant:"–°–æ—Ñ—å—è –ú–∞—Ä—Ç—ã–Ω–æ–≤–∞",
      },
      cast:[
        {actor:"–î–∞–Ω–∏–∏–ª –ü–ª–∞—Ç–æ–Ω–æ–≤", role:"–û–Ω"},
        {actor:"–í–µ—Ä–∞ –°—Ç–µ–ø–∞–Ω–æ–≤–∞", role:"–û–Ω–∞"},
        {actor:"–ì–ª–µ–± –†—è–∑–∞–Ω–æ–≤", role:"–¢–µ–Ω—å"},
      ],
      description:
`–ù–µ–∂–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ —Ç–æ–º, –∫–∞–∫ –≤ —Å–∞–º—ã—Ö –æ–±—ã—á–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç–∞—Ö –≤–¥—Ä—É–≥ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —á—É–¥–æ.
–ò–Ω–æ–≥–¥–∞ –æ–Ω–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –º—É–∑—ã–∫—É, –∏–Ω–æ–≥–¥–∞ ‚Äî —á–µ—Ä–µ–∑ –≤–∑–≥–ª—è–¥, –∞ –∏–Ω–æ–≥–¥–∞ ‚Äî —á–µ—Ä–µ–∑ —Ç–∏—à–∏–Ω—É.
–≠—Ç–æ—Ç —Å–ø–µ–∫—Ç–∞–∫–ª—å –æ –ø–∞–º—è—Ç–∏, –ª—é–±–≤–∏ –∏ —Å–º–µ–ª–æ—Å—Ç–∏ —Å–Ω–æ–≤–∞ –∑–∞—Ö–æ—Ç–µ—Ç—å.`
    },
    {
      id:"figaro",
      title:"–ñ–µ–Ω–∏—Ç—å–±–∞ –§–∏–≥–∞—Ä–æ",
      city:"–ú–æ—Å–∫–≤–∞",
      venue:"–ú–æ—Å–∫–≤–∞, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è 6",
      poster:"https://images.unsplash.com/photo-1507924538820-ede94a04019d?auto=format&fit=crop&w=800&q=70",
      about:{
        director:"–ï–≤–≥–µ–Ω–∏–π –ü–∏—Å–∞—Ä–µ–≤",
        artist:"–ê–Ω–¥—Ä–µ–∞—Å —Ñ–æ–Ω –®–ª–∏–ø–ø–µ",
        producer:"–í–ª–∞–¥–∏–º–∏—Ä –ü—Ä—É–¥–∫–∏–Ω",
        music:"–¢–∏–º—É—Ä –ü–æ–ª—è–Ω—Å–∫–∏–π",
        light:"–°–µ—Ä–≥–µ–π –ù–µ–≤–≥–∞–¥–æ–≤—Å–∫–∏–π",
        ballet:"–ê–Ω–∂–µ–ª–∏–∫–∞ –ë–æ—Ä–∏—Å–æ–≤–∞",
        sound:"–°–µ—Ä–≥–µ–π –®–µ–≤—á–µ–Ω–∫–æ",
        video:"–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë—Ä–∞—Ç–∏–Ω–æ–≤",
        assistant:"–õ—é–±–æ–≤—å –°–∫–∏—Ä–∫–æ",
      },
      cast:[
        {actor:"–ò—Ä–∏–Ω–∞ –ì—Ä–∏—â–µ–Ω–∫–æ", role:"–ö–∞—Ä–µ–Ω –°—Ç–æ—É–Ω"},
        {actor:"–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –¢–µ–º–ª—è–∫", role:"–ü–∞–æ–ª–æ"},
        {actor:"–ò—Ä–∏–Ω–∞ –ú–µ–ª—å–Ω–∏–∫", role:"–ì—Ä–∞—Ñ–∏–Ω—è"},
        {actor:"–Æ–ª–∏—è –ë—Ä—É—Å–µ–Ω—Ü–µ–≤–∞", role:"–°–ª—É–≥–∏ –ø—Ä–æ—Å—Ü–µ–Ω–∏—É–º–∞"},
      ],
      description:
`–ö–æ–º–µ–¥–∏—è ¬´–ñ–µ–Ω–∏—Ç—å–±–∞ –§–∏–≥–∞—Ä–æ¬ª, –ø—Ä–∏–¥—É–º–∞–Ω–Ω–∞—è –ø—Ä–∏–¥–≤–æ—Ä–Ω—ã–º —á–∞—Å–æ–≤—â–∏–∫–æ–º –ë–æ–º–∞—Ä—à–µ,
–Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ —Ç—Ä—ë—Ö —Å—Ç–æ–ª–µ—Ç–∏–π –ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–≥—Ä–æ–º–Ω—ã–º —É—Å–ø–µ—Ö–æ–º –±–ª–∞–≥–æ–¥–∞—Ä—è –∏–¥–µ–∞–ª—å–Ω–æ–π,
—Å–ª–æ–≤–Ω–æ —á–∞—Å–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏, –¥–∏–Ω–∞–º–∏—á–Ω–æ—Å—Ç–∏ –∏ —é–º–æ—Ä—É, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —É—Ç—Ä–∞—Ç–∏–ª
—Å–≤–æ–µ–π —Å–≤–µ–∂–µ—Å—Ç–∏. –ù–æ –≥–ª–∞–≤–Ω—ã–π —Å–µ–∫—Ä–µ—Ç —É—Å–ø–µ—Ö–∞, –∫–æ–Ω–µ—á–Ω–æ, –≤ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–µ –≥–µ—Ä–æ—è:
—Ç–∞–ª–∞–Ω—Ç–ª–∏–≤—ã–π –§–∏–≥–∞—Ä–æ —Ç–µ—Ä–ø–∏—Ç –∫—Ä—É—à–µ–Ω–∏–µ –≤–æ –≤—Å–µ—Ö –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏—è—Ö...`
    }
  ];

  localStorage.setItem(K.DATA, JSON.stringify({shows}));
}

function loadData(){
  return JSON.parse(localStorage.getItem(K.DATA));
}

function getHiddenDays(){
  return JSON.parse(localStorage.getItem(K.HIDDEN_DAYS) || "[]");
}

function formatDateRU(d){
  const dd=String(d.getDate()).padStart(2,"0");
  const mm=String(d.getMonth()+1).padStart(2,"0");
  const yyyy=d.getFullYear();
  return `${dd}.${mm}.${yyyy}`;
}

function pickShowDateForList(showId){
  // –≤—ã–±–∏—Ä–∞–µ–º –±–ª–∏–∂–∞–π—à—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –¥–∞—Ç—É (–Ω–µ —Å–∫—Ä—ã—Ç—É—é) –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ
  const {start, end} = todayRangeToEndOfMonth();
  const hidden = new Set(getHiddenDays());
  for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1)){
    const key = `${showId}|${d.toISOString().slice(0,10)}`;
    if(!hidden.has(key)) return new Date(d);
  }
  return null;
}

function render(){
  const bal = Number(localStorage.getItem(K.BAL) || "0");
  document.getElementById("bal").textContent = rub(bal);

  const {shows} = loadData();
  const list = document.getElementById("list");
  list.innerHTML = "";

  shows.forEach(s=>{
    const dt = pickShowDateForList(s.id);
    // –µ—Å–ª–∏ —É —Å–ø–µ–∫—Ç–∞–∫–ª—è –≤—Å–µ –¥–∞—Ç—ã —Å–∫—Ä—ã—Ç—ã ‚Äî –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ
    if(!dt) return;

    const card = document.createElement("div");
    card.className="item";
    card.innerHTML = `
      <div class="poster">
        <img alt="" src="${s.poster}">
      </div>
      <div>
        <div class="title">${s.title}</div>
        <div class="meta">${s.city}, <span>${formatDateRU(dt)},</span></div>
        <a class="buy" href="show.html?id=${encodeURIComponent(s.id)}">–ö—É–ø–∏—Ç—å</a>
      </div>
    `;
    list.appendChild(card);
  });

  if(!list.children.length){
    list.innerHTML = `<div style="padding:22px;color:#6b7280">–ù–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç (–≤–æ–∑–º–æ–∂–Ω–æ, –≤—Å—ë —Å–∫—Ä—ã—Ç–æ –≤ –∞–¥–º–∏–Ω–∫–µ).</div>`;
  }
}

/** SUPPORT BOT */
const chat = document.getElementById("chat");
const body = document.getElementById("chatBody");
function addMsg(text, who="bot"){
  const div=document.createElement("div");
  div.className="msg "+(who==="me"?"me":"bot");
  div.textContent=text;
  body.appendChild(div);
  body.scrollTop = body.scrollHeight;
}
function botReply(q){
  const t = q.toLowerCase();
  if(t.includes("–∫–∞–∫ –∫—É–ø–∏—Ç—å")) return "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ–∫—Ç–∞–∫–ª—å ‚Üí –¥–∞—Ç—É ‚Üí –º–µ—Å—Ç–∞ –Ω–∞ —Å—Ö–µ–º–µ ‚Üí –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û/—Ç–µ–ª–µ—Ñ–æ–Ω/email ‚Üí –æ–ø–ª–∞—Ç–∏—Ç–µ —Å –∫–æ—à–µ–ª—å–∫–∞.";
  if(t.includes("–Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç")) return "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –≤ ¬´–ö–æ—à–µ–ª—å–∫–µ¬ª. –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Äî –ø–æ–ø–æ–ª–Ω–∏—Ç–µ. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É.";
  if(t.includes("–≤–æ–∑–≤—Ä–∞—Ç")) return "–î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É: –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –¥–∞—Ç—É —Å–ø–µ–∫—Ç–∞–∫–ª—è. –ú—ã —Å–≤—è–∂–µ–º—Å—è.";
  if(t.includes("–∑–∞—è–≤–∫")) return "–ù–∞–ø–∏—à–∏—Ç–µ: –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, –∫—Ä–∞—Ç–∫–æ –ø—Ä–æ–±–ª–µ–º—É. –Ø —Å–æ—Ö—Ä–∞–Ω—é –∑–∞—è–≤–∫—É.";
  return "–ü–æ–Ω—è–ª. –ù–∞–ø–∏—à–∏—Ç–µ —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî —è –ø–æ–º–æ–≥—É üôÇ";
}
function saveTicket(text){
  const arr = JSON.parse(localStorage.getItem(K.SUPPORT) || "[]");
  arr.push({ts:Date.now(), text});
  localStorage.setItem(K.SUPPORT, JSON.stringify(arr));
}

document.getElementById("supportBtn").onclick = ()=>{
  chat.style.display = (chat.style.display==="none" || !chat.style.display) ? "block" : "none";
  if(!body.children.length){
    addMsg("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø support. –ß–µ–º –ø–æ–º–æ—á—å?");
  }
};
document.getElementById("chatClose").onclick = ()=> chat.style.display="none";
document.getElementById("chatSend").onclick = ()=>{
  const inp=document.getElementById("chatInput");
  const q=inp.value.trim();
  if(!q) return;
  addMsg(q,"me");
  inp.value="";
  const a = botReply(q);
  addMsg(a,"bot");
  if(q.toLowerCase().includes("–∑–∞—è–≤–∫") || q.toLowerCase().includes("—Ñ–∏–æ") || q.toLowerCase().includes("—Ç–µ–ª")){
    saveTicket(q);
  }
};
document.getElementById("chatInput").addEventListener("keydown",(e)=>{
  if(e.key==="Enter") document.getElementById("chatSend").click();
});
document.querySelectorAll(".quick button").forEach(b=>{
  b.onclick=()=>{
    const q=b.dataset.q;
    document.getElementById("chatInput").value=q;
    document.getElementById("chatSend").click();
  };
});

/** INIT */
resetIfNewMonth();
seedDataIfMissing();
render();
</script>
</body>
</html>
