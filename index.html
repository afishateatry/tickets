<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>АФИША — Театр</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f3f4f6; --card:#ffffff; --text:#0b0b0c; --muted:#6b7280; --line:#e5e7eb;
      --shadow:0 18px 40px rgba(0,0,0,.12);

      --seat:#8b93a6; --sold:#d1d5db;
      --p2500:#1f7a2e; --p3500:#b455d6; --p5000:#ff2b2b; --p5500:#17ff17;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(#0b0b0c 0 240px, var(--bg) 240px 100%);
      color:var(--text);
    }
    .hero{padding:18px 14px 18px;display:flex;align-items:center;justify-content:center;gap:12px;color:#fff}
    .heroTitle{font-weight:900;letter-spacing:.06em;font-size:44px;text-transform:uppercase}
    .heroSm{width:54px;height:54px;border-radius:50%;background:#fbbf24;display:grid;place-items:center;color:#0b0b0c;font-weight:900;box-shadow:0 16px 30px rgba(0,0,0,.25);font-size:26px}
    .heroSub{text-align:center;color:#fff;opacity:.9;letter-spacing:.35em;font-weight:800;margin:-2px 0 12px}
    .wrap{max-width:980px;margin:0 auto;padding:0 12px 48px}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:22px;box-shadow:var(--shadow);overflow:hidden}
    .topbar{display:flex;gap:12px;justify-content:space-between;align-items:center;padding:14px;background:#fff;border-bottom:1px solid var(--line)}
    .pill{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border:1px solid var(--line);border-radius:999px;background:#fff;color:var(--text);text-decoration:none;font-weight:900;font-size:16px;cursor:pointer}
    .screenTitle{margin:0;padding:22px 18px;text-align:center;font-size:48px;font-weight:900;border-bottom:1px solid var(--line);background:#fff}
    .list{display:flex;flex-direction:column}
    .item{display:grid;grid-template-columns:140px 1fr;gap:18px;padding:18px;background:#fff;border-top:1px solid var(--line);align-items:center}
    .item:first-child{border-top:none}
    .poster{width:140px;height:140px;border-radius:16px;overflow:hidden;box-shadow:0 14px 26px rgba(0,0,0,.18);background:#111}
    .poster img{width:100%;height:100%;object-fit:cover;display:block}
    .tTitle{font-size:40px;font-weight:900;line-height:1.02;margin:0 0 10px}
    .tMeta{font-size:22px;font-weight:900;margin:0 0 14px}
    .btn{
      width:min(520px,100%);height:74px;border:none;border-radius:14px;
      background:linear-gradient(180deg,#1a1a1b,#000);color:#fff;font-weight:900;font-size:24px;
      cursor:pointer;box-shadow:0 18px 36px rgba(0,0,0,.2)
    }
    .btn:active{transform:scale(.99)}

    .card{background:#fff;border:1px solid var(--line);border-radius:22px;box-shadow:var(--shadow);overflow:hidden}
    .eventHead{display:grid;grid-template-columns:160px 1fr;gap:18px;padding:18px;border-bottom:1px solid var(--line);background:#fff}
    .eventHead .poster{width:160px;height:160px;border-radius:18px}
    .hint{margin-top:10px;color:#6b7280;font-weight:900;font-size:16px;text-align:center;line-height:1.2}
    .section{padding:18px;border-top:1px solid var(--line);background:#fff}
    .secTitle{font-size:54px;font-weight:900;margin:0 0 14px}
    .kv{font-size:20px;line-height:1.6}
    .kv b{font-weight:900}
    .desc{white-space:pre-wrap;color:#374151;font-size:20px;line-height:1.75}

    .legend{padding:14px 18px;border-bottom:1px solid var(--line);display:flex;flex-wrap:wrap;gap:16px;align-items:center;background:#fff;font-weight:900}
    .lg{display:flex;gap:10px;align-items:center}
    .sq{width:18px;height:18px;border-radius:2px;background:#999}
    .hallTitle{margin:0;padding:18px 18px;text-align:center;color:#fff;background:linear-gradient(180deg,#1a1a1b,#000);font-weight:900;font-size:28px}
    .hall{padding:18px 18px 8px;background:#fff}
    .rows{display:flex;flex-direction:column;gap:12px;align-items:center}
    .row{display:flex;gap:10px;align-items:center}
    .rowNum{width:22px;text-align:right;font-weight:900;color:#111}
    .seats{display:flex;gap:8px;flex-wrap:nowrap}
    .seat{width:30px;height:30px;border-radius:2px;background:var(--seat);color:#fff;display:grid;place-items:center;font-size:12px;font-weight:900;cursor:pointer;user-select:none}
    .seat.sold{background:var(--sold);color:#6b7280;cursor:not-allowed}
    .seat.sel{outline:3px solid #111827;outline-offset:1px}
    .seat.p2500{background:var(--p2500)} .seat.p3500{background:var(--p3500)} .seat.p5000{background:var(--p5000)} .seat.p5500{background:var(--p5500)}

    .stage{margin:14px 18px 12px;border-radius:14px;background:linear-gradient(180deg,#1a1a1b,#000);color:#fff;text-align:center;font-weight:900;font-size:40px;padding:18px 12px}
    .footer{padding:14px 18px;border-top:1px solid var(--line);display:grid;grid-template-columns:1fr 240px;gap:12px;align-items:center;background:#fff}
    .total{font-size:54px;font-weight:900}
    .form{padding:16px 18px 22px;border-top:1px solid var(--line);background:#fff}
    .field{margin:10px 0}
    .field input{width:100%;padding:18px 16px;border:1px solid var(--line);border-radius:14px;font-size:18px;font-weight:800;outline:none}

    .supportBtn{
      position:fixed;right:18px;bottom:18px;width:78px;height:78px;border-radius:50%;border:none;cursor:pointer;
      background:radial-gradient(circle at 30% 30%, #60a5fa, #2563eb 55%, #1d4ed8 100%);
      box-shadow:0 20px 50px rgba(0,0,0,.28);
      display:grid;place-items:center;z-index:9999
    }
    .supportBtn svg{width:36px;height:36px;fill:#fff}

    @media (max-width:560px){
      .heroTitle{font-size:40px}
      .screenTitle{font-size:44px}
      .item{grid-template-columns:130px 1fr}
      .poster{width:130px;height:130px}
      .tTitle{font-size:36px}
      .tMeta{font-size:20px}
      .btn{height:70px;font-size:22px}
      .eventHead{grid-template-columns:140px 1fr}
      .eventHead .poster{width:140px;height:140px}
      .secTitle{font-size:46px}
      .total{font-size:44px}
      .footer{grid-template-columns:1fr 160px}
    }
  </style>
</head>
<body>
  <div class="hero">
    <div class="heroTitle">АФИША</div>
    <div class="heroSm">☺</div>
  </div>
  <div class="heroSub">ТЕАТР</div>

  <div class="wrap" id="app"></div>

  <button class="supportBtn" id="supportBtn" title="Support">
    <svg viewBox="0 0 24 24"><path d="M12 3C7.03 3 3 6.58 3 11c0 2.05.87 3.92 2.3 5.33L4.5 20.5l4.38-1.46c.98.29 2.03.46 3.12.46 4.97 0 9-3.58 9-8s-4.03-8-9-8zm-4 9h8a1 1 0 0 1 0 2H8a1 1 0 0 1 0-2zm0-3h8a1 1 0 1 1 0 2H8a1 1 0 0 1 0-2z"/></svg>
  </button>

<script>
/* ========================
   LIVE DATA (NO BOT LOOK)
   - different crew
   - different cast
   - different description
   - theatre photos
   - only from today to end of month
   - new month auto refresh
======================== */
const K = {
  SOLD: "AFISHA_SOLD_V2",
  MONTH: "AFISHA_MONTH_V2"
};

const app = document.getElementById("app");

function yyyy_mm(d=new Date()){
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;
}
function rangeTodayToEndOfMonth(){
  const now=new Date();
  const start=new Date(now.getFullYear(),now.getMonth(),now.getDate());
  const end=new Date(now.getFullYear(),now.getMonth()+1,0);
  return {start,end};
}
function iso(d){ return d.toISOString().slice(0,10); }
function ruDate(isoDate){
  const [y,m,d]=isoDate.split("-");
  return `${d}.${m}.${y}`;
}
function seededRand(str){
  let h=2166136261>>>0;
  for(let i=0;i<str.length;i++){ h^=str.charCodeAt(i); h=Math.imul(h,16777619); }
  return ()=>{ h+=h<<13; h^=h>>>7; h+=h<<3; h^=h>>>17; h+=h<<5; return ((h>>>0)%100000)/100000; };
}
function pick(r, arr){ return arr[Math.floor(r()*arr.length)]; }
function uniqPick(r, arr, n){
  const a=[...arr];
  const out=[];
  while(out.length<n && a.length){
    const i=Math.floor(r()*a.length);
    out.push(a.splice(i,1)[0]);
  }
  return out;
}
function escapeHtml(s){
  return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

/* ---- theatre photos only ---- */
const THEATRE_PHOTOS = [
  "https://images.unsplash.com/photo-1545239351-1141bd82e8a6?auto=format&fit=crop&w=1100&q=70",
  "https://images.unsplash.com/photo-1529156069898-49953e39b3ac?auto=format&fit=crop&w=1100&q=70",
  "https://images.unsplash.com/photo-1520697830682-bbb6e85e2b0d?auto=format&fit=crop&w=1100&q=70",
  "https://images.unsplash.com/photo-1526481280695-3c687fd5432c?auto=format&fit=crop&w=1100&q=70",
  "https://images.unsplash.com/photo-1507924538820-ede94a04019d?auto=format&fit=crop&w=1100&q=70",
  "https://images.unsplash.com/photo-1521336575822-6da63fb45455?auto=format&fit=crop&w=1100&q=70",
  "https://images.unsplash.com/photo-1485562569060-2eec283d3391?auto=format&fit=crop&w=1100&q=70",
  "https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?auto=format&fit=crop&w=1100&q=70"
];

/* ---- realistic pools ---- */
const TITLES = [
  "Дядя Ваня","Король Лир","Женитьба Фигаро","Герой нашего времени","Тонкая линия",
  "Седьмой ряд","Театр теней","Город без сна","Ночной экспресс","Осколки памяти",
  "Письма в тишину","Портрет ветра","Странный вечер","Три шага до весны","Внутри музыки",
  "Свет со сцены","Чужая роль","Зал ожидания","Последний акт","Точка тишины"
];

const DIRECTORS = ["Евгений Писарев","Илья Соколов","Марина Кузнецова","Александр Фомин","Никита Ланской","Виктория Волкова","Дмитрий Север","Елена Климова"];
const ARTISTS  = ["Андреас фон Шлиппе","Мария Волошина","Елена Климова","Софья Мартынова","Ирина Селезнёва","Кирилл Лебедев","Ольга Миронова"];
const PRODUCERS= ["Владимир Прудкин","Алексей Смирнов","Тимур Полянский","Сергей Шевченко","Анжелика Борисова","Алина Коваль"];
const MUSIC    = ["Тимур Полянский","Алексей Смирнов","Николай Ветров","Дмитрий Север","Марина Синицына","Екатерина Жданова"];
const LIGHT    = ["Сергей Невгадовский","Марина Синицына","Игорь Сафонов","Елена Климова","Ксения Артемьева"];
const SOUND    = ["Сергей Шевченко","Алина Коваль","Николай Ветров","Дмитрий Север"];
const VIDEO    = ["Александр Братинов","Антон Громов","Павел Ильин"];
const ASSIST   = ["Любовь Скирко","Дарья Зайцева","Софья Мартынова","Екатерина Жданова"];

/* актёры и роли — большой пул, чтобы редко повторялось */
const ACTORS = [
  "Ирина Грищенко","Константин Темляк","Ирина Мельник","Юлия Брусенцева","Сергей Невгадовский",
  "Анна Романова","Кирилл Лебедев","Ольга Селезнёва","Михаил Назаров","Павел Ильин",
  "Ксения Артемьева","Игорь Сафонов","Вера Степанова","Глеб Рязанов","Даниил Платонов",
  "Мария Волошина","Александр Фомин","Никита Ланской","Виктория Волкова","Елена Климова"
];

const ROLES = [
  "Печорин","Грушницкий","Вера","Мери","Астров","Соня","Елена Андреевна","Войницкий",
  "Фигаро","Граф","Графиня","Сюзанна","Лир","Глостер","Шут","Эдгар","Ведущий","Гостья",
  "Он","Она","Тень","Странник","Рассказчик","Слуги просцениума","Хранитель сцены"
];

const TIME_POOL = ["18:00","19:00","20:00","21:00","22:00"];

/* описания — шаблоны + переменные (реалистичнее) */
const DESC_TEMPLATES = [
  ({title, theme, mood}) => `«${title}» — ${mood} спектакль о ${theme}.
Здесь нет простых ответов: герои спорят с судьбой, прячутся за шутками и всё равно
возвращаются к главному — что важнее: победить или не потерять себя.
Сцены собираются в единый ритм, как дыхание зала — то громче, то почти шёпотом.`,
  ({title, theme, mood}) => `Это история, в которой театр становится зеркалом.
«${title}» звучит как внутренний дневник: честно, резко и неожиданно нежно.
Мы следим за выбором героев и понимаем, что ${theme} — не сюжет, а личный опыт.
И когда занавес опускается, остаётся то, что не сыграешь: тишина и ясность.`,
  ({title, theme, mood}) => `«${title}» — ${mood} постановка, где важна каждая пауза.
Здесь ${theme} проявляется не словами, а взглядом, шагом, расстоянием между людьми.
Спектакль двигается как музыка: сначала лёгкий мотив, потом — напряжение,
и в финале — точка, после которой хочется молчать ещё минуту.`
];

const THEMES = [
  "выборе и цене выбора","памяти и вине","любви и упрямстве","страхе быть собой","правде, которую не говорят вслух",
  "одиночестве в толпе","власти привычек","попытке начать заново","хрупкости доверия","силе прощения"
];
const MOODS = ["нежная, но острая","парадоксально смешная","тихая и пронзительная","жёсткая и честная","светлая и нервная"];

function buildEventForDate(dateISO){
  const r = seededRand("event|" + dateISO);
  const title = pick(r, TITLES);
  const time  = pick(r, TIME_POOL);
  const poster = pick(r, THEATRE_PHOTOS);

  // у каждого спектакля своя команда (разные поля и значения)
  const about = {
    director: pick(r, DIRECTORS),
    artist:   pick(r, ARTISTS),
    producer: pick(r, PRODUCERS),
    music:    pick(r, MUSIC),
    light:    pick(r, LIGHT),
    sound:    pick(r, SOUND),
    video:    pick(r, VIDEO),
    assistant:pick(r, ASSIST),
  };

  // актёры: 4–6 человек, роли тоже разные
  const castCount = 4 + Math.floor(r()*3); // 4..6
  const actors = uniqPick(r, ACTORS, castCount);
  const roles  = uniqPick(r, ROLES, castCount);
  const cast = actors.map((a,i)=>({actor:a, role: roles[i] || pick(r, ROLES)}));

  // описание: шаблон + переменные
  const theme = pick(r, THEMES);
  const mood  = pick(r, MOODS);
  const descFn = pick(r, DESC_TEMPLATES);
  const description = descFn({title, theme, mood});

  return {
    id: "e_" + dateISO,
    title,
    city:"Москва",
    venue:"Москва, ул. Большая Садовая 6",
    date: dateISO,
    time,
    poster,
    about,
    cast,
    description
  };
}

function liveEvents(){
  // авто-обновление при новом месяце + можно чистить старые sold, чтобы не росло
  const curMonth = yyyy_mm();
  const stored = localStorage.getItem(K.MONTH);
  if(stored !== curMonth){
    localStorage.setItem(K.MONTH, curMonth);
    // очистим занятости старого месяца
    localStorage.removeItem(K.SOLD);
  }

  const {start,end} = rangeTodayToEndOfMonth();
  const events = [];
  for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1)){
    // один спектакль в день (как ты сказал: можно один)
    events.push(buildEventForDate(iso(d)));
  }
  return events;
}

/* ========================
   ROUTER (SPA)
======================== */
function route(){
  const hash = location.hash || "#afisha";
  const [page, param] = hash.split(":");
  if(page === "#event") return renderEvent(param);
  if(page === "#buy") return renderBuy(param);
  return renderAfisha();
}
window.addEventListener("hashchange", route);

/* ========================
   Screens
======================== */
function renderAfisha(){
  const events = liveEvents();

  app.innerHTML = `
    <div class="panel">
      <div class="topbar">
        <div class="pill" onclick="location.hash='#afisha'">← Афиша</div>
        <div class="pill" onclick="alert('Support: вставь сюда ссылку на Telegram/WhatsApp')">Support</div>
      </div>
      <div class="screenTitle">Театр</div>
      <div class="list" id="list"></div>
    </div>
  `;

  const list = document.getElementById("list");
  events.forEach(e=>{
    const el = document.createElement("div");
    el.className="item";
    el.innerHTML = `
      <div class="poster"><img alt="" src="${e.poster}"></div>
      <div>
        <div class="tTitle">${e.title}</div>
        <div class="tMeta">${e.city},<br>${ruDate(e.date)}, ${e.time},</div>
        <button class="btn">Купить</button>
      </div>
    `;
    el.querySelector("button").onclick = ()=> location.hash = `#event:${e.id}`;
    list.appendChild(el);
  });
}

function findEvent(id){
  const events = liveEvents();
  return events.find(x=>x.id===id);
}

function renderEvent(id){
  const e = findEvent(id);
  if(!e){ location.hash="#afisha"; return; }

  const labels = {
    director:"Режиссер-постановщик",
    artist:"Художник-постановщик",
    producer:"Продюсеры",
    music:"Музыкальное оформление",
    light:"Художник по освещению",
    sound:"Звукорежиссер",
    video:"Видео",
    assistant:"Помощник режиссера",
  };

  app.innerHTML = `
    <div class="topbar" style="border-radius:22px;box-shadow:var(--shadow);border:1px solid var(--line);margin-bottom:12px">
      <div class="pill" onclick="location.hash='#afisha'">← Афиша</div>
      <div class="pill" onclick="location.hash='#afisha'">Театр</div>
    </div>

    <div class="card">
      <div class="eventHead">
        <div class="poster"><img alt="" src="${e.poster}"></div>
        <div>
          <div class="tTitle">${e.title}</div>
          <div class="tMeta">${e.city},<br>${ruDate(e.date)}, ${e.time}</div>
          <button class="btn" id="goBuy">Купить</button>
          <div class="hint">Переход на схему зала<br>→ выбор мест → оплата</div>
        </div>
      </div>

      <div class="section">
        <div class="secTitle">О событии:</div>
        <div class="kv">
          ${Object.entries(e.about).map(([k,v])=>`<div><b>${labels[k]||k}</b> — ${v}</div>`).join("")}
        </div>
      </div>

      <div class="section">
        <div class="secTitle">Актёрский<br>состав:</div>
        <div class="kv">
          ${e.cast.map(x=>`<div><b>${x.actor}</b> - ${x.role}</div>`).join("")}
        </div>
      </div>

      <div class="section">
        <div class="secTitle">Описание:</div>
        <div class="desc">${escapeHtml(e.description)}</div>
      </div>
    </div>
  `;

  document.getElementById("goBuy").onclick = ()=> location.hash = `#buy:${e.id}`;
}

function renderBuy(id){
  const e = findEvent(id);
  if(!e){ location.hash="#afisha"; return; }

  // 7 рядов как ты хотел
  const layout = [
    {row:7, seats:16},{row:6, seats:16},{row:5, seats:15},
    {row:4, seats:15},{row:3, seats:13},{row:2, seats:13},{row:1, seats:13},
  ];

  function priceFor(row, seat){
    if(row===1){
      if([3,4,12,13].includes(seat)) return 5500;
      if([7,8,9].includes(seat)) return 5000;
      return 2500;
    }
    if(row===2){
      if([3,7,9,12,13].includes(seat)) return 3500;
      if([6,8].includes(seat)) return 5000;
      return 2500;
    }
    if(row===3){
      if([2,8,9].includes(seat)) return 3500;
      return 2500;
    }
    if(row===4){
      if([5,10,11,14].includes(seat)) return 3500;
      return 2500;
    }
    if(row===5){
      if([5,8,13].includes(seat)) return 3500;
      return 2500;
    }
    if(row===6){
      if([4,12].includes(seat)) return 2500;
      return 0;
    }
    if(row===7){
      if([2,8].includes(seat)) return 2500;
      return 0;
    }
    return 0;
  }
  function priceClass(p){
    if(p===2500) return "p2500";
    if(p===3500) return "p3500";
    if(p===5000) return "p5000";
    if(p===5500) return "p5500";
    return "";
  }

  // занятость как на скринах: пары рядом + не слишком много
  const perfKey = `sold_${e.id}`;
  const soldAll = JSON.parse(localStorage.getItem(K.SOLD)||"{}");
  if(!soldAll[perfKey]){
    const r = seededRand(perfKey);
    const sold = {};
    layout.forEach(row=>{
      const pairs = Math.max(1, Math.floor(row.seats*(0.12 + r()*0.04)/2)); // ~12-16% занято
      for(let i=0;i<pairs;i++){
        const s = 1 + Math.floor(r()*(row.seats-1));
        sold[`${row.row}-${s}`]=true;
        sold[`${row.row}-${s+1}`]=true;
      }
    });
    soldAll[perfKey]=sold;
    localStorage.setItem(K.SOLD, JSON.stringify(soldAll));
  }
  const sold = soldAll[perfKey];
  const selected = new Set();

  app.innerHTML = `
    <div class="topbar" style="border-radius:22px;box-shadow:var(--shadow);border:1px solid var(--line);margin-bottom:12px">
      <div class="pill" onclick="location.hash='#event:${e.id}'">← Назад</div>
      <div class="pill" onclick="location.hash='#afisha'">Афиша</div>
    </div>

    <div class="card">
      <div class="topbar" style="border-bottom:1px solid var(--line);border-radius:0;box-shadow:none">
        <div class="pill" style="cursor:default">Выбор мест</div>
        <div class="pill" style="cursor:default">${e.city}, ${ruDate(e.date)}, ${e.time}</div>
      </div>

      <div class="legend">
        <div class="lg"><span class="sq" style="background:var(--seat)"></span> свободно</div>
        <div class="lg"><span class="sq" style="background:var(--sold)"></span> занято</div>
        <div class="lg"><span class="sq" style="background:var(--p2500)"></span> 2500 руб.</div>
        <div class="lg"><span class="sq" style="background:var(--p3500)"></span> 3500 руб.</div>
        <div class="lg"><span class="sq" style="background:var(--p5000)"></span> 5000 руб.</div>
        <div class="lg"><span class="sq" style="background:var(--p5500)"></span> 5500 руб.</div>
      </div>

      <div class="hallTitle">Схема зала</div>
      <div class="hall"><div class="rows" id="rows"></div></div>
      <div class="stage">Сцена</div>

      <div class="footer">
        <div class="total" id="total">Всего: 0 руб.</div>
        <button class="btn" id="buyBtn" style="height:78px">Купить</button>
      </div>

      <div class="form">
        <div class="field"><input id="fio" placeholder="ФИО"></div>
        <div class="field"><input id="phone" placeholder="Ваш телефон"></div>
        <div class="field"><input id="email" placeholder="E-mail"></div>
      </div>
    </div>
  `;

  function recalc(){
    let sum=0;
    selected.forEach(k=>{
      const [r,s]=k.split("-").map(Number);
      sum += (priceFor(r,s) || 2500);
    });
    document.getElementById("total").textContent = `Всего: ${sum.toLocaleString("ru-RU")} руб.`;
    return sum;
  }

  function renderRows(){
    const rowsEl=document.getElementById("rows");
    rowsEl.innerHTML="";
    layout.forEach(r=>{
      const rowEl=document.createElement("div");
      rowEl.className="row";
      const rn=document.createElement("div");
      rn.className="rowNum";
      rn.textContent=r.row;
      rowEl.appendChild(rn);

      const seats=document.createElement("div");
      seats.className="seats";

      for(let s=1;s<=r.seats;s++){
        const key=`${r.row}-${s}`;
        const seat=document.createElement("div");
        seat.className="seat";
        seat.textContent=s;

        const p=priceFor(r.row,s);
        if(p>0) seat.classList.add(priceClass(p));

        if(sold[key]) seat.classList.add("sold");
        if(selected.has(key)) seat.classList.add("sel");

        seat.onclick=()=>{
          if(sold[key]) return;
          selected.has(key) ? selected.delete(key) : selected.add(key);
          renderRows(); recalc();
        };
        seats.appendChild(seat);
      }

      rowEl.appendChild(seats);
      rowsEl.appendChild(rowEl);
    });
    recalc();
  }
  renderRows();

  document.getElementById("buyBtn").onclick=()=>{
    const sum=recalc();
    if(sum<=0) return alert("Выберите места.");

    const fio=document.getElementById("fio").value.trim();
    const phone=document.getElementById("phone").value.trim();
    const email=document.getElementById("email").value.trim();
    if(!fio || !phone || !email) return alert("Заполните ФИО, телефон и E-mail.");

    // фиксируем покупку
    selected.forEach(k=> sold[k]=true);
    soldAll[perfKey]=sold;
    localStorage.setItem(K.SOLD, JSON.stringify(soldAll));

    alert("Спасибо за покупку!");
    location.hash="#afisha";
  };
}

/* Support button */
document.getElementById("supportBtn").onclick = ()=>{
  alert("Support: сюда вставь ссылку на Telegram/WhatsApp.\nНапример: https://t.me/your_support");
};

/* Start */
route();
</script>
</body>
</html>
