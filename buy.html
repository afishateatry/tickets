<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–í—ã–±–æ—Ä –º–µ—Å—Ç</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f3f4f6; --card:#fff; --text:#0b0b0c; --muted:#6b7280; --line:#e5e7eb;
      --shadow:0 18px 40px rgba(0,0,0,.12);
      --seat:#8b93a6; --seatText:#fff;
      --sold:#d1d5db;
      --selOutline:#111827;
      --price1:#1f7a2e;   /* 2500 */
      --price2:#b455d6;   /* 3500 */
      --price3:#ff2b2b;   /* 5000 */
      --price4:#17ff17;   /* 5500 */
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:980px;margin:0 auto;padding:12px 12px 40px;}
    .top{display:flex;gap:10px;justify-content:space-between;align-items:center;margin:10px 0 12px;}
    a.pill{display:inline-flex;gap:8px;align-items:center;padding:10px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;color:var(--text);text-decoration:none;font-weight:800;font-size:14px}
    .card{background:#fff;border:1px solid var(--line);border-radius:20px;box-shadow:var(--shadow);overflow:hidden;}
    .head{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between}
    .h1{font-size:22px;font-weight:900}
    .sub{font-size:13px;color:var(--muted);font-weight:700}
    .legend{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;gap:16px;flex-wrap:wrap;align-items:center}
    .lg{display:flex;gap:10px;align-items:center;font-weight:800}
    .sq{width:18px;height:18px;border-radius:2px;background:#999}
    .hallTitle{margin:0;padding:18px 16px;text-align:center;color:#fff;background:linear-gradient(180deg,#1a1a1b,#000);font-weight:900;font-size:26px}
    .hall{padding:18px 16px 8px;background:#fff;}
    .rows{display:flex;flex-direction:column;gap:12px;align-items:center}
    .row{display:flex;gap:10px;align-items:center}
    .rowNum{width:22px;text-align:right;font-weight:900;color:#111}
    .seats{display:flex;gap:8px;flex-wrap:nowrap}
    .seat{
      width:28px;height:28px;border-radius:2px;background:var(--seat);color:var(--seatText);
      display:grid;place-items:center;font-size:12px;font-weight:900;user-select:none;cursor:pointer;
      box-shadow:0 2px 0 rgba(0,0,0,.12);
      transition:transform .05s ease, filter .08s ease;
    }
    .seat:active{transform:scale(.98)}
    .seat.sold{background:var(--sold);color:#6b7280;cursor:not-allowed;box-shadow:none}
    .seat.sel{outline:3px solid var(--selOutline);outline-offset:1px}
    .seat.p2500{background:var(--price1)}
    .seat.p3500{background:var(--price2)}
    .seat.p5000{background:var(--price3)}
    .seat.p5500{background:var(--price4)}
    .stage{margin:14px 16px 12px;border-radius:12px;background:linear-gradient(180deg,#1a1a1b,#000);color:#fff;text-align:center;font-weight:900;font-size:34px;padding:18px 12px}
    .footer{padding:14px 16px;border-top:1px solid var(--line);display:grid;grid-template-columns:1fr 240px;gap:12px;align-items:center}
    .total{font-size:44px;font-weight:900}
    .buyBtn{height:70px;border:none;border-radius:12px;background:linear-gradient(180deg,#1a1a1b,#000);color:#fff;font-weight:900;font-size:22px;cursor:pointer;box-shadow:0 16px 30px rgba(0,0,0,.18)}
    .form{padding:14px 16px 18px;border-top:1px solid var(--line);background:#fff}
    .field{display:flex;flex-direction:column;gap:8px;margin:10px 0}
    .field input{padding:16px 14px;border:1px solid var(--line);border-radius:12px;font-size:16px;font-weight:700;outline:none;background:#fff}
    .hint{color:var(--muted);font-weight:700;font-size:13px;margin-top:8px}
    @media(max-width:720px){
      .footer{grid-template-columns:1fr 160px}
      .total{font-size:38px}
      .buyBtn{height:64px;font-size:20px}
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <a class="pill" href="index.html">‚Üê –ê—Ñ–∏—à–∞</a>
    <a class="pill" href="wallet.html">üí≥ –ö–æ—à–µ–ª—ë–∫ <b id="bal">0 ‚ÇΩ</b></a>
  </div>

  <div class="card" id="card">
    <div class="head">
      <div>
        <div class="h1" id="title">–í—ã–±–æ—Ä –º–µ—Å—Ç</div>
        <div class="sub" id="meta">...</div>
      </div>
      <div class="sub" style="text-align:right">
        <div><b>–í—ã–±–æ—Ä –º–µ—Å—Ç</b></div>
        <div>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–µ—Å—Ç–æ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å</div>
      </div>
    </div>

    <div class="legend">
      <div class="lg"><span class="sq" style="background:var(--seat)"></span> —Å–≤–æ–±–æ–¥–Ω–æ</div>
      <div class="lg"><span class="sq" style="background:var(--sold)"></span> –∑–∞–Ω—è—Ç–æ</div>
      <div class="lg"><span class="sq" style="background:var(--price1)"></span> 2500 —Ä—É–±.</div>
      <div class="lg"><span class="sq" style="background:var(--price2)"></span> 3500 —Ä—É–±.</div>
      <div class="lg"><span class="sq" style="background:var(--price3)"></span> 5000 —Ä—É–±.</div>
      <div class="lg"><span class="sq" style="background:var(--price4)"></span> 5500 —Ä—É–±.</div>
    </div>

    <div class="hallTitle">–°—Ö–µ–º–∞ –∑–∞–ª–∞</div>
    <div class="hall"><div class="rows" id="rows"></div></div>
    <div class="stage">–°—Ü–µ–Ω–∞</div>

    <div class="footer">
      <div class="total" id="total">–í—Å–µ–≥–æ: 0 —Ä—É–±.</div>
      <button class="buyBtn" id="buy">–ö—É–ø–∏—Ç—å</button>
    </div>

    <div class="form">
      <div class="field"><input id="venue" readonly></div>
      <div class="field"><input id="datetime" readonly></div>
      <div class="field"><input id="fio" placeholder="–§–ò–û"></div>
      <div class="field"><input id="phone" placeholder="–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω"></div>
      <div class="field"><input id="email" placeholder="E-mail"></div>
      <div class="hint">–ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –±–∞–ª–∞–Ω—Å–∞ ‚Äî –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –æ–ø–ª–∞—Ç—ã.</div>
    </div>
  </div>
</div>

<script>
const K = {
  EVENTS:"THEATRE_EVENTS_V2",
  BAL:"THEATRE_BALANCE_V1",
  BOOKINGS:"THEATRE_BOOKINGS_V2"
};

function qs(k){ return new URLSearchParams(location.search).get(k); }
function rub(n){ return (n||0).toLocaleString("ru-RU"); }
function getBal(){ return Number(localStorage.getItem(K.BAL) || "0"); }
function setBal(v){ localStorage.setItem(K.BAL, String(v)); }
function getBookings(){ return JSON.parse(localStorage.getItem(K.BOOKINGS) || "{}"); }
function setBookings(obj){ localStorage.setItem(K.BOOKINGS, JSON.stringify(obj)); }
function formatRU(isoDate){
  const [y,m,d]=String(isoDate||"").split("-");
  if(!y) return "";
  return `${d}.${m}.${y}`;
}
function seededRand(str){
  let h=2166136261>>>0;
  for(let i=0;i<str.length;i++){ h^=str.charCodeAt(i); h=Math.imul(h,16777619); }
  return ()=>{ h+=h<<13; h^=h>>>7; h+=h<<3; h^=h>>>17; h+=h<<5; return ((h>>>0)%100000)/100000; };
}
function rangeToEndOfMonth(){
  const now=new Date();
  const start=new Date(now.getFullYear(),now.getMonth(),now.getDate());
  const end=new Date(now.getFullYear(),now.getMonth()+1,0);
  return {start,end};
}
function iso(d){ return d.toISOString().slice(0,10); }

function loadEvents(){
  return JSON.parse(localStorage.getItem(K.EVENTS)||'{"events":[]}');
}
function saveEvents(v){
  localStorage.setItem(K.EVENTS, JSON.stringify(v));
}

// –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–π –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–¥–∏–º (—á—Ç–æ–±—ã buy.html –Ω–µ –ø–∞–¥–∞–ª)
function seedEventsIfMissing(){
  const cur = loadEvents();
  if(cur.events && cur.events.length) return;

  const titles = ["–¢–æ–Ω–∫–∞—è –ª–∏–Ω–∏—è","–¢–µ–∞—Ç—Ä —Ç–µ–Ω–µ–π","–°–µ–¥—å–º–æ–π —Ä—è–¥","–ì–æ—Ä–æ–¥ –±–µ–∑ —Å–Ω–∞","–ù–æ—á–Ω–æ–π —ç–∫—Å–ø—Ä–µ—Å—Å","–ñ–µ–Ω–∏—Ç—å–±–∞ –§–∏–≥–∞—Ä–æ","–î—è–¥—è –í–∞–Ω—è","–ì–µ—Ä–æ–π –Ω–∞—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏"];
  const posters = [
    "https://images.unsplash.com/photo-1545239351-1141bd82e8a6?auto=format&fit=crop&w=800&q=70",
    "https://images.unsplash.com/photo-1529156069898-49953e39b3ac?auto=format&fit=crop&w=800&q=70",
    "https://images.unsplash.com/photo-1521336575822-6da63fb45455?auto=format&fit=crop&w=800&q=70"
  ];
  const descriptions = [
`–°–ø–µ–∫—Ç–∞–∫–ª—å –æ –≤—ã–±–æ—Ä–µ –∏ —Ü–µ–Ω–µ –≤—ã–±–æ—Ä–∞. –ì–µ—Ä–æ–∏ —Å–ø–æ—Ä—è—Ç —Å —Å—É–¥—å–±–æ–π, —Å–º–µ—é—Ç—Å—è –Ω–∞–¥ —Å—Ç—Ä–∞—Ö–æ–º, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É: —á—Ç–æ –≤–∞–∂–Ω–µ–µ ‚Äî –ø–æ–±–µ–¥–∏—Ç—å –∏–ª–∏ –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –≥–ª–∞–≤–Ω–æ–µ?`,
`–ò—Å—Ç–æ—Ä–∏—è –æ —Ç–æ–º, –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫ —É—á–∏—Ç—Å—è –±—ã—Ç—å —á–µ—Å—Ç–Ω—ã–º ‚Äî –Ω–µ —Å –¥—Ä—É–≥–∏–º–∏, –∞ —Å —Å–æ–±–æ–π. –ó–¥–µ—Å—å –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤, –∑–∞—Ç–æ –µ—Å—Ç—å —Ç–æ—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã.`,
`–ö–æ–º–µ–¥–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –º–µ—Ö–∞–Ω–∏–∑–º: —Å—Ü–µ–Ω—ã —Å–º–µ–Ω—è—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ, —Ä–µ–ø–ª–∏–∫–∏ —Ç–æ—á–Ω—ã, –∞ —Å–º–µ—Ö –≤–Ω–µ–∑–∞–ø–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–µ—Ä—å—ë–∑–Ω—ã–º.`
  ];
  const about = {
    director:"–ï–≤–≥–µ–Ω–∏–π –ü–∏—Å–∞—Ä–µ–≤",
    artist:"–ê–Ω–¥—Ä–µ–∞—Å —Ñ–æ–Ω –®–ª–∏–ø–ø–µ",
    producer:"–í–ª–∞–¥–∏–º–∏—Ä –ü—Ä—É–¥–∫–∏–Ω",
    music:"–¢–∏–º—É—Ä –ü–æ–ª—è–Ω—Å–∫–∏–π",
    light:"–°–µ—Ä–≥–µ–π –ù–µ–≤–≥–∞–¥–æ–≤—Å–∫–∏–π",
    ballet:"–ê–Ω–∂–µ–ª–∏–∫–∞ –ë–æ—Ä–∏—Å–æ–≤–∞",
    sound:"–°–µ—Ä–≥–µ–π –®–µ–≤—á–µ–Ω–∫–æ",
    video:"–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ë—Ä–∞—Ç–∏–Ω–æ–≤",
    assistant:"–õ—é–±–æ–≤—å –°–∫–∏—Ä–∫–æ",
  };
  const castPool = [
    ["–ò—Ä–∏–Ω–∞ –ì—Ä–∏—â–µ–Ω–∫–æ","–ö–∞—Ä–µ–Ω –°—Ç–æ—É–Ω"],["–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –¢–µ–º–ª—è–∫","–ü–∞–æ–ª–æ"],["–ò—Ä–∏–Ω–∞ –ú–µ–ª—å–Ω–∏–∫","–ì—Ä–∞—Ñ–∏–Ω—è"],
    ["–Æ–ª–∏—è –ë—Ä—É—Å–µ–Ω—Ü–µ–≤–∞","–°–ª—É–≥–∏ –ø—Ä–æ—Å—Ü–µ–Ω–∏—É–º–∞"],["–°–µ—Ä–≥–µ–π –ù–µ–≤–≥–∞–¥–æ–≤—Å–∫–∏–π","–ê—Å—Ç—Ä–æ–≤"],["–ê–Ω–Ω–∞ –†–æ–º–∞–Ω–æ–≤–∞","–í–µ—Ä–∞"]
  ];
  const times = ["18:00","19:00","20:00","21:00","22:00"];

  const {start,end} = rangeToEndOfMonth();
  const events=[];
  let idx=0;

  for(let d=new Date(start); d<=end; d.setDate(d.getDate()+1)){
    for(let k=0;k<2;k++){
      const dateISO=iso(d);
      const id=`e_${dateISO}_${k}`;
      const r=seededRand(id);
      const title=titles[(idx + Math.floor(r()*titles.length)) % titles.length] + (k? " ‚Äî –í–µ—á–µ—Ä":"");
      const poster=posters[Math.floor(r()*posters.length)];
      const description=descriptions[Math.floor(r()*descriptions.length)];
      const time=times[Math.floor(r()*times.length)];
      const cast=[];
      const used=new Set();
      while(cast.length<4){
        const pick=castPool[Math.floor(r()*castPool.length)];
        const key=pick[0]+"|"+pick[1];
        if(used.has(key)) continue;
        used.add(key);
        cast.push({actor:pick[0], role:pick[1]});
      }
      events.push({id,title,city:"–ú–æ—Å–∫–≤–∞",venue:"–ú–æ—Å–∫–≤–∞, —É–ª. –ë–æ–ª—å—à–∞—è –°–∞–¥–æ–≤–∞—è 6",date:dateISO,time,poster,about,cast,description});
      idx++;
    }
  }
  saveEvents({events});
}

seedEventsIfMissing();

const id = qs("id");
document.getElementById("bal").textContent = " " + (getBal().toLocaleString("ru-RU") + " ‚ÇΩ");

// –µ—Å–ª–∏ id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –ø–æ–∫–∞–∂–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É
if(!id){
  document.getElementById("card").innerHTML = `
    <div style="padding:18px;font-weight:900;font-size:22px">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞</div>
    <div style="padding:0 18px 18px;color:#6b7280;font-weight:700">–û—Ç–∫—Ä–æ–π ¬´–ê—Ñ–∏—à–∞¬ª ‚Üí –≤—ã–±–µ—Ä–∏ —Å–ø–µ–∫—Ç–∞–∫–ª—å ‚Üí –Ω–∞–∂–º–∏ ¬´–ö—É–ø–∏—Ç—å¬ª.</div>
    <div style="padding:0 18px 18px"><a class="pill" href="index.html">‚Üê –í –ê—Ñ–∏—à—É</a></div>
  `;
  throw new Error("no id");
}

const {events} = loadEvents();
const e = events.find(x=>x.id===id);
if(!e){
  document.getElementById("card").innerHTML = `
    <div style="padding:18px;font-weight:900;font-size:22px">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞</div>
    <div style="padding:0 18px 18px;color:#6b7280;font-weight:700">
      –°–æ–±—ã—Ç–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –Ω–∞ —Å–∞–π—Ç–µ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –¥–∞–Ω–Ω—ã—Ö.
      –û—Ç–∫—Ä–æ–π –∞–¥–º–∏–Ω–∫—É ‚Üí –Ω–∞–∂–º–∏ ¬´–°–±—Ä–æ—Å–∏—Ç—å –º–µ—Å—è—Ü¬ª, –∑–∞—Ç–µ–º –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.
    </div>
    <div style="padding:0 18px 18px;display:flex;gap:10px;flex-wrap:wrap">
      <a class="pill" href="admin.html">‚öôÔ∏è –ê–¥–º–∏–Ω</a>
      <a class="pill" href="index.html">‚Üê –ê—Ñ–∏—à–∞</a>
    </div>
  `;
  throw new Error("event not found");
}

document.getElementById("title").textContent = e.title;
document.getElementById("meta").textContent = `${e.city}, ${formatRU(e.date)}, ${e.time}`;
document.getElementById("venue").value = e.venue;
document.getElementById("datetime").value = `${formatRU(e.date)}, ${e.time}`;

/** 7 —Ä—è–¥–æ–≤ */
const layout = [
  {row:7, seats:16},
  {row:6, seats:16},
  {row:5, seats:15},
  {row:4, seats:15},
  {row:3, seats:13},
  {row:2, seats:13},
  {row:1, seats:13},
];

/** –∑–æ–Ω—ã */
function priceFor(row, seat){
  if(row===1){
    if([3,4,12,13].includes(seat)) return 5500;
    if([7,8,9].includes(seat)) return 5000;
    return 2500;
  }
  if(row===2){
    if([3,7,9,12,13].includes(seat)) return 3500;
    if([6,8].includes(seat)) return 5000;
    return 2500;
  }
  if(row===3){
    if([2,8,9].includes(seat)) return 3500;
    return 2500;
  }
  if(row===4){
    if([5,10,11,14].includes(seat)) return 3500;
    return 2500;
  }
  if(row===5){
    if([5,8,13].includes(seat)) return 3500;
    return 2500;
  }
  if(row===6){
    if([4,12].includes(seat)) return 2500;
    return 0;
  }
  if(row===7){
    if([2,8].includes(seat)) return 2500;
    return 0;
  }
  return 0;
}
function priceClass(p){
  if(p===2500) return "p2500";
  if(p===3500) return "p3500";
  if(p===5000) return "p5000";
  if(p===5500) return "p5500";
  return "";
}

/** –∑–∞–Ω—è—Ç–æ—Å—Ç—å: –ø–∞—Ä—ã —Ä—è–¥–æ–º */
const perfKey = `event|${e.id}`;
const bookings = getBookings();
bookings[perfKey] = bookings[perfKey] || { sold: {}, seeded:false };

if(!bookings[perfKey].seeded){
  bookings[perfKey].seeded=true;
  const r=seededRand(perfKey);
  layout.forEach(row=>{
    const count=row.seats;
    const pairs = Math.max(1, Math.floor(count * (0.10 + r()*0.04) / 2));
    for(let i=0;i<pairs;i++){
      const s=1+Math.floor(r()*(count-1));
      if(bookings[perfKey].sold[`${row.row}-${s}`]) continue;
      if(bookings[perfKey].sold[`${row.row}-${s+1}`]) continue;
      bookings[perfKey].sold[`${row.row}-${s}`]=true;
      bookings[perfKey].sold[`${row.row}-${s+1}`]=true;
    }
  });
  setBookings(bookings);
}

const selected=new Set();

function recompute(){
  let sum=0;
  selected.forEach(key=>{
    const [row,seat]=key.split("-").map(Number);
    const p=priceFor(row,seat) || 2500;
    sum+=p;
  });
  document.getElementById("total").textContent = `–í—Å–µ–≥–æ: ${rub(sum)} —Ä—É–±.`;
  return sum;
}

function renderSeats(){
  const rowsEl=document.getElementById("rows");
  rowsEl.innerHTML="";
  const soldMap = getBookings()[perfKey]?.sold || {};
  layout.forEach(r=>{
    const rowEl=document.createElement("div");
    rowEl.className="row";

    const rowNum=document.createElement("div");
    rowNum.className="rowNum";
    rowNum.textContent=r.row;
    rowEl.appendChild(rowNum);

    const seats=document.createElement("div");
    seats.className="seats";

    for(let s=1;s<=r.seats;s++){
      const key=`${r.row}-${s}`;
      const btn=document.createElement("div");
      btn.className="seat";
      btn.textContent=s;

      const p=priceFor(r.row,s);
      if(p>0) btn.classList.add(priceClass(p));

      const sold=!!soldMap[key];
      if(sold) btn.classList.add("sold");
      if(selected.has(key)) btn.classList.add("sel");

      btn.onclick=()=>{
        if(sold) return;
        if(selected.has(key)) selected.delete(key);
        else selected.add(key);
        renderSeats();
        recompute();
      };
      seats.appendChild(btn);
    }
    rowEl.appendChild(seats);
    rowsEl.appendChild(rowEl);
  });
  recompute();
}
renderSeats();

document.getElementById("buy").onclick=()=>{
  const sum=recompute();
  if(sum<=0){ alert("–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–∞."); return; }

  const fio=document.getElementById("fio").value.trim();
  const phone=document.getElementById("phone").value.trim();
  const email=document.getElementById("email").value.trim();
  if(!fio || !phone || !email){
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ E-mail.");
    return;
  }

  const bal=getBal();
  if(bal < sum){
    const need=sum-bal;
    const go=confirm(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç ${need.toLocaleString("ru-RU")} ‚ÇΩ. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã?`);
    if(go) location.href = `pay.html?amount=${encodeURIComponent(need)}&return=wallet.html`;
    return;
  }

  setBal(bal - sum);

  const b=getBookings();
  b[perfKey]=b[perfKey] || {sold:{}, seeded:true};
  selected.forEach(k=> b[perfKey].sold[k]=true);
  setBookings(b);

  alert("–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É!");
  selected.clear();
  document.getElementById("bal").textContent = " " + (getBal().toLocaleString("ru-RU") + " ‚ÇΩ");
  renderSeats();
};
</script>
</body>
</html>
