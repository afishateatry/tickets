<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ê–¥–º–∏–Ω</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f3f4f6;--card:#fff;--text:#0b0b0c;--muted:#6b7280;--line:#e5e7eb;--shadow:0 18px 40px rgba(0,0,0,.12);}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);}
    .wrap{max-width:980px;margin:0 auto;padding:12px 12px 40px;}
    .top{display:flex;gap:10px;justify-content:space-between;align-items:center;margin:10px 0 12px;}
    a.pill{display:inline-flex;gap:8px;align-items:center;padding:10px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;color:var(--text);text-decoration:none;font-weight:800;font-size:14px}
    .card{background:#fff;border:1px solid var(--line);border-radius:20px;box-shadow:var(--shadow);padding:16px;margin-bottom:12px;}
    h1{margin:0 0 12px;font-size:34px;font-weight:900}
    h2{margin:0 0 10px;font-size:22px;font-weight:900}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:820px){.grid{grid-template-columns:1fr}}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    select,input,textarea{
      width:100%;
      padding:12px 12px;border:1px solid var(--line);border-radius:12px;
      font-weight:800;outline:none
    }
    textarea{min-height:120px;font-weight:700;line-height:1.4}
    button{
      padding:12px 14px;border:none;border-radius:12px;
      background:linear-gradient(180deg,#1a1a1b,#000);color:#fff;font-weight:900;cursor:pointer;
    }
    .muted{color:var(--muted);font-weight:700;font-size:13px;margin-top:8px}
    .list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .chip{display:flex;gap:10px;align-items:center;justify-content:space-between;border:1px solid var(--line);border-radius:12px;padding:10px 12px}
    .chip b{font-weight:900}
    .chip button{background:#111827}
    .danger{background:#b91c1c}
    .miniBtn{padding:10px 12px;border-radius:12px}
    .k{font-weight:900}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <a class="pill" href="index.html">‚Üê –ê—Ñ–∏—à–∞</a>
    <a class="pill" href="wallet.html">üí≥ –ö–æ—à–µ–ª—ë–∫</a>
  </div>

  <div class="card">
    <h1>–ê–¥–º–∏–Ω</h1>
    <div class="muted">
      ‚úÖ –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã (—á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–∞ —Å–∞–π—Ç–µ).  
      ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ –º–µ—Å—è—Ü–∞ —Å–∫—Ä—ã—Ç–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è (–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ –≤—Ä—É—á–Ω—É—é).
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>–°–∫—Ä—ã—Ç—å –¥–µ–Ω—å</h2>
      <div class="row">
        <select id="showSel"></select>
      </div>
      <div class="row" style="margin-top:10px">
        <input id="date" type="date">
      </div>
      <div class="row" style="margin-top:10px">
        <button id="hide">–°–∫—Ä—ã—Ç—å –¥–∞—Ç—É</button>
        <button id="unhide" class="miniBtn" style="background:#111827">–ü–æ–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É</button>
      </div>
      <div class="muted">–§–æ—Ä–º–∞—Ç –∫–ª—é—á–∞ —Å–∫—Ä—ã—Ç–∏—è: <span class="k">—Å–ø–µ–∫—Ç–∞–∫–ª—å|YYYY-MM-DD</span></div>

      <div style="margin-top:14px;border-top:1px solid #e5e7eb;padding-top:12px">
        <div class="row">
          <button id="reset" class="danger">–°–±—Ä–æ—Å–∏—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –¥–∞—Ç—ã (—Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü)</button>
        </div>
        <div class="muted">–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äú–æ–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—è—Ü —Å –ø–µ—Ä–≤–æ–≥–æ —á–∏—Å–ª–∞‚Äù ‚Äî –∂–º—ë—à—å —Å–±—Ä–æ—Å, –∏ –¥–∞—Ç—ã —Å–Ω–æ–≤–∞ –ø–æ—è–≤—è—Ç—Å—è.</div>
      </div>
    </div>

    <div class="card">
      <h2>–°–∫—Ä—ã—Ç—ã–µ –¥–∞—Ç—ã</h2>
      <div id="hiddenList" class="list"></div>
    </div>
  </div>

  <div class="card">
    <h2>–†–µ–¥–∞–∫—Ç–æ—Ä —Å–ø–µ–∫—Ç–∞–∫–ª–µ–π (–±—ã—Å—Ç—Ä–æ)</h2>
    <div class="muted">–ú–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç—ã/–∞–∫—Ç—ë—Ä–æ–≤/–æ–ø–∏—Å–∞–Ω–∏–µ. –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–∏ –∞—Ñ–∏—à—É.</div>
    <div class="row" style="margin-top:10px">
      <select id="editSel"></select>
    </div>
    <div class="row" style="margin-top:10px">
      <input id="editTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
    </div>
    <div class="row" style="margin-top:10px">
      <input id="editPoster" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç–µ—Ä (–∫–∞—Ä—Ç–∏–Ω–∫–∞)">
    </div>
    <div class="row" style="margin-top:10px">
      <textarea id="editDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
    </div>
    <div class="row" style="margin-top:10px">
      <textarea id="editCast" placeholder="–ê–∫—Ç—ë—Ä—ã (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞: –ê–∫—Ç—ë—Ä - –†–æ–ª—å)"></textarea>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="saveShow">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–µ–∫—Ç–∞–∫–ª—å</button>
    </div>
  </div>

</div>

<script>
const K = {
  DATA:"THEATRE_DATA_V1",
  HIDDEN_DAYS:"THEATRE_HIDDEN_DAYS_V1",
  MONTH:"THEATRE_MONTH_MARK_V1",
};

function yyyy_mm(){ const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`; }
function resetIfNewMonth(){
  const mark = localStorage.getItem(K.MONTH);
  const cur = yyyy_mm();
  if(mark !== cur){
    localStorage.setItem(K.MONTH, cur);
    localStorage.removeItem(K.HIDDEN_DAYS);
  }
}
function loadData(){ return JSON.parse(localStorage.getItem(K.DATA)); }
function saveData(v){ localStorage.setItem(K.DATA, JSON.stringify(v)); }
function getHidden(){ return JSON.parse(localStorage.getItem(K.HIDDEN_DAYS)||"[]"); }
function setHidden(arr){ localStorage.setItem(K.HIDDEN_DAYS, JSON.stringify(arr)); }

resetIfNewMonth();

const data = loadData();
const showSel = document.getElementById("showSel");
const editSel = document.getElementById("editSel");

function fillSelects(){
  showSel.innerHTML="";
  editSel.innerHTML="";
  data.shows.forEach(s=>{
    const o1=document.createElement("option");
    o1.value=s.id; o1.textContent=s.title;
    showSel.appendChild(o1);

    const o2=document.createElement("option");
    o2.value=s.id; o2.textContent=s.title;
    editSel.appendChild(o2);
  });
}
fillSelects();

function renderHidden(){
  const list=document.getElementById("hiddenList");
  const arr=getHidden();
  if(!arr.length){
    list.innerHTML = `<div style="color:#6b7280;font-weight:700">–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ —Å–∫—Ä—ã—Ç–æ.</div>`;
    return;
  }
  list.innerHTML="";
  arr.slice().reverse().forEach(key=>{
    const [id, iso] = key.split("|");
    const show = data.shows.find(x=>x.id===id);
    const div=document.createElement("div");
    div.className="chip";
    div.innerHTML = `
      <div><b>${show?show.title:id}</b><div style="color:#6b7280;font-weight:700">${iso}</div></div>
      <button data-k="${key}">–£–¥–∞–ª–∏—Ç—å</button>
    `;
    div.querySelector("button").onclick=()=>{
      const a=getHidden().filter(x=>x!==key);
      setHidden(a);
      renderHidden();
    };
    list.appendChild(div);
  });
}
renderHidden();

document.getElementById("hide").onclick=()=>{
  const id=showSel.value;
  const iso=document.getElementById("date").value;
  if(!iso){ alert("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É"); return; }
  const key=`${id}|${iso}`;
  const arr=getHidden();
  if(!arr.includes(key)) arr.push(key);
  setHidden(arr);
  renderHidden();
  alert("–°–∫—Ä—ã—Ç–æ.");
};

document.getElementById("unhide").onclick=()=>{
  const id=showSel.value;
  const iso=document.getElementById("date").value;
  if(!iso){ alert("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É"); return; }
  const key=`${id}|${iso}`;
  const arr=getHidden().filter(x=>x!==key);
  setHidden(arr);
  renderHidden();
  alert("–ü–æ–∫–∞–∑–∞–Ω–æ.");
};

document.getElementById("reset").onclick=()=>{
  if(confirm("–°–±—Ä–æ—Å–∏—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –¥–∞—Ç—ã —ç—Ç–æ–≥–æ –º–µ—Å—è—Ü–∞?")){
    localStorage.removeItem(K.HIDDEN_DAYS);
    renderHidden();
    alert("–°–±—Ä–æ—à–µ–Ω–æ.");
  }
};

/** Editor */
function loadEditor(){
  const id=editSel.value;
  const s=data.shows.find(x=>x.id===id);
  if(!s) return;
  document.getElementById("editTitle").value = s.title || "";
  document.getElementById("editPoster").value = s.poster || "";
  document.getElementById("editDesc").value = s.description || "";
  document.getElementById("editCast").value = (s.cast||[]).map(x=>`${x.actor} - ${x.role}`).join("\n");
}
editSel.onchange = loadEditor;
loadEditor();

document.getElementById("saveShow").onclick=()=>{
  const id=editSel.value;
  const s=data.shows.find(x=>x.id===id);
  if(!s) return;

  s.title = document.getElementById("editTitle").value.trim() || s.title;
  s.poster = document.getElementById("editPoster").value.trim() || s.poster;
  s.description = document.getElementById("editDesc").value.trim() || s.description;

  const castLines = document.getElementById("editCast").value.split("\n").map(x=>x.trim()).filter(Boolean);
  s.cast = castLines.map(line=>{
    const parts=line.split(" - ");
    return {actor:(parts[0]||"").trim(), role:(parts.slice(1).join(" - ")||"").trim()};
  });

  saveData(data);
  alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ. –û–±–Ω–æ–≤–∏—Ç–µ –∞—Ñ–∏—à—É (index.html).");
};
</script>
</body>
</html>
